;==============================================================
; CNS File for Babidi Z2 by Balthazar, Daeron & XGargoyle
; Helper States
;==============================================================

;==============================================================
;AI ACTIVATION
;==============================================================
;Adapted from Winane's (http://www.mugenguild.com/winane)
[Statedef 9741]
type=A
movetype=I
physics=N
anim=9741
ctrl=0

[State 9741, wrong]
type=destroyself
trigger1= (parent,ID)!=(root,ID)
[State 9741, Safety]
type=selfstate
trigger1= !ishelper
value=0

[State 9741, uglyhack]
type=varset
trigger1= !var(1)
var(2)=1
[State 9741, pausecheck]
type=varset
trigger1= gametime>root,var(58)
trigger2= !(root,alive)
trigger3= roundstate!=2
trigger4= root,var(59)
var(2)=1

[State 9741, facing]
type=turn
trigger1= var(9):=(facing!=root,facing)

[State 9741, dirturnonAI]
type=parentvarset
triggerall= !var(2) && !var(9)
trigger1= root,command="fwd"
trigger2= root,command="back"
trigger3= root,command="up"
trigger4= root,command="down"
var(59)=1
[State 9741, dirturnoffAI]
type=parentvarset
triggerall= !var(2) && !var(9) && (root,var(59)>=1)
trigger1= command="fwd" && root,command="fwd"
trigger2= command="back" && root,command="back"
trigger3= command="up" && root,command="up"
trigger4= command="down" && root,command="down"
var(59)=-1

[State 9741, buttonturnonAI]
type=parentvarset
triggerall= !var(2)
trigger1= root,command="a"
trigger2= root,command="b"
trigger3= root,command="c"
trigger4= root,command="x"
trigger5= root,command="y"
trigger6= root,command="z"
trigger7= root,command="s"
var(59)=1
[State 9741, buttonturnoffAI]
type=parentvarset
triggerall= !var(2) && (root,var(59)>=1)
trigger1= command="a" && root,command="a"
trigger2= command="b" && root,command="b"
trigger3= command="c" && root,command="c"
trigger4= command="x" && root,command="x"
trigger5= command="y" && root,command="y"
trigger6= command="z" && root,command="z"
trigger7= command="s" && root,command="s"
var(59)=-1

[State 9741, unpausecheck]
type=varset
triggerall= var(2)
trigger1= root,command="fwd" || root,command="back" || root,command="up" || root,command="down"
trigger2= root,command="a" || root,command="b" || root,command="c"
trigger3= root,command="x" || root,command="y" || root,command="z"
trigger4= root,command="s"
trigger5= var(2)=1
trigger5= var(2):=0
var(2)=1

[State 9741, goodbye]
type=destroyself
triggerall= var(1):=1
trigger1= root,var(59)
trigger2= !(root,alive)
trigger3= roundstate!=2



;-------------------------------------------------------------------------------
;YAKON HELPER
[Statedef 2100]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = -10

[State 0, Pause]
type = null ;Pause
trigger1 = 1
time = 100
movetime = 100
;endcmdbuftime = 0
pausebg = 1
;ignorehitpause =
;persistent =


[State 3121, PlaySnd]  ;Yakon Walking
type = PlaySnd
trigger1 = !time
value = 2100,0
channel = 5

[State 0, VelSet]
type = VelSet
trigger1 = !time
x = 0.5
;ignorehitpause =
;persistent =

[State 0, EnvShake]
type = EnvShake
trigger1 = !time
trigger2 = time=40
trigger3 = time=70
time = 30 ;90
freq = 20
ampl = 3


[State 3302, anim]
type = changeanim
trigger1 = !time
value = 2100

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
;value = SCA, NA, SA, HA, NT, ST, HT
value = SCA, NA, SA, HA, NP, SP, HP, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = null;HitBy
trigger1 = Time >= 0
value = SCA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = null;HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2102
attr = SCA, NP, SP, HP
ignorehitpause = 1

[State 0, Yakon Explod]
type = Explod
trigger1 = !time
anim = 2100
ID = 2100
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = -1
vel = 0,0
accel = 0,0
random = 0,0
removetime = -2
pausemovetime = 9999 ;0
scale = 1,1
sprpriority = 0
ontop = 1
shadow = 0,0,0
ownpal = 1
removeongethit = 0
;ignorehitpause =
;trans =
;persistent =
;supermove = 0
;pausemove = 0

[State 0, EnvColor]
type = EnvColor
trigger1 = 1
value = 0,0,0
time = 1
under = 0
ignorehitpause = 1
;persistent =


[State 3302, NoShadow]
type = AssertSpecial
trigger1 = 1
flag = noshadow
flag2 = noBG
flag3 = noFG
ignorehitpause = 1



[State 0, VelSet]
type = VelSet
trigger1 = AnimElemTime(7)=60
x = -1
y = 0.2
;ignorehitpause =
;persistent =


[State 0, ChangeState]
type = ChangeState
trigger1 = time = 120 ;!animtime
value = 2101
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

;YAKON ATTACK HELPER
[Statedef 2101]
type = A
movetype = A
physics = N
ctrl = 0
sprpriority = -10

[State 0, Pause]
type = Pause
trigger1 = !time
time = 0
movetime = 0
pausebg = 0


[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !time
id = 2100
ignorehitpause = 1
;persistent =

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 2101

[State 3302, NoShadow]
type = AssertSpecial
trigger1 = 1
flag = noshadow
flag2 = noBG
flag3 = noFG
ignorehitpause = 1

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = NumHelper(19875)>0
flag = invisible
ignorehitpause = 1

[State 0, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 0
movecamera = 0,0
ignorehitpause = 1
;persistent =

[State 0, EnvColor]
type = EnvColor
trigger1 = 1
value = 0,0,0
time = 1
under = 0
ignorehitpause = 1
;persistent =

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NA, SA, HA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2102
attr = SCA, NP, SP, HP
ignorehitpause = 1


[State 0, Explod]
type = Explod
triggerall = !NumExplod(2101)
trigger1 = Anim=2101
anim = 2101
ID = 2101
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = -1
vel = 0,0
accel = 0,0
random = 0,0
removetime = -1
pausemovetime = 9999 ;0
scale = 1,1
sprpriority = -10
ontop = 1
shadow = 0,0,0
ownpal = 1
removeongethit = 1
ignorehitpause = 1
;trans =
;persistent =
;supermove = 0
;pausemove = 0

[State 3302, Velocity]
type = VelSet
trigger1 = !time
x = 16 ;8

[State 3121, PlaySnd]  ;Yakon Dash
type = PlaySnd
trigger1 = !time
trigger2 =  Anim=2102
trigger2 =  AnimElemTime(1)=0
value = 40,1
channel = 5

[State 3302, hit fwd]
type = hitdef
trigger1 = anim=2101
attr = S,HA
hitflag = MAFD
guardflag = MA
priority = 7,Hit
damage = 130,13
getpower = 0,0
givepower = 20,20
pausetime = 0,60 ;8, 8
animtype = Hard
air.animtype = Hard
fall.animtype = Hard
ground.type = Low
air.type = Low
ground.hittime = 16
ground.slidetime = 16
guard.hittime = 16
air.hittime = 13
airguard.ctrltime = 16
ground.velocity= 2,0
guard.velocity = 2 ;-9
air.velocity = -5.5,-3.9
airguard.velocity = -5.5, -1.5
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
yaccel = .5
fall=1
air.fall = 1
fall.recover = 0
fall.recovertime = 30
sparkno = -1
hitsound   = s2100,1
guardsound = S6,1
envshake.time = 16
envshake.ampl = 6
envshake.freq = 100
forcestand = 1
palfx.sinadd=64,64,64,4
palfx.mul=128,128,128
palfx.time=32
p1sprpriority = 5
kill = 0
persistent=0



[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = pos x!=[-300,300]
value = 2102
;elem = 1
;ignorehitpause =
;persistent =

[State 3302, Velocity]
type = VelSet
trigger1 = pos x!=[-300,300]
x = -16 ;-8

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = Anim=2102
trigger2 = NumHelper(19875)>0
id = 2101
ignorehitpause = 1
;persistent =


[State 0, Yakon Explod]
type = Explod
triggerall = !NumExplod(2102)
trigger1 = Anim=2102
anim = 2102
ID = 2102
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = -1
vel = 0,0
accel = 0,0
random = 0,0
removetime = -1
pausemovetime = 9999 ;0
scale = 1,1
sprpriority = -10
ontop = 1
shadow = 0,0,0
ownpal = 1
removeongethit = 1
ignorehitpause = 1
;trans =
;persistent =
;supermove = 0
;pausemove = 0



[State 3302, hit back]
type = hitdef
trigger1 = anim=2102
attr = S,HA
hitflag = MAFD
guardflag = MA
priority = 7,Hit
damage = 130,13
getpower = 0,0
givepower = 20,20
pausetime = 0,40 ;8, 8
animtype = DiagUp ;Light
air.animtype = DiagUp ;Light
fall.animtype = DiagUp ;Light
ground.type = Low
air.type = Low
ground.hittime = 16
ground.slidetime = 16
guard.hittime = 16
air.hittime = 13
airguard.ctrltime = 16
ground.velocity= 5,-5 ;2,0
guard.velocity = 2 ;-9
air.velocity = 5.5,-3.9
airguard.velocity = 5.5, -1.5
ground.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
air.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
yaccel = .5
fall=1
air.fall = 1
fall.recover = 0
fall.recovertime = 30
sparkno = -1
hitsound   = s2100,1
guardsound = S6,1
envshake.time = 16
envshake.ampl = 6
envshake.freq = 100
;forcestand = 1
palfx.sinadd=64,64,64,4
palfx.mul=128,128,128
palfx.time=32
p1sprpriority = 5
persistent=0

[State 3302, Sparks fwd]
type=explod
triggerall = Anim=2101
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim = 7200
id = 7200
sprpriority=10
postype=left ;p2
pos=floor((enemy,screenpos X))-72*facing,240
removetime=-1
ownpal=1
ontop = 1
facing=facing
ignorehitpause=1
persistent=0


[State 3302, Sparks back]
type=explod
triggerall = Anim=2102
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim = 7200
id = 7200
sprpriority=10
postype=left ;p2
pos=floor((enemy,screenpos X))+72*facing,240
removetime=-1
ownpal=1
ontop = 1
facing=-facing
ignorehitpause=1
persistent=0

[State 3302, Guard Sparks fwd]
type=explod
triggerall = Anim=2101
trigger1= moveguarded=1
anim=7010
sprpriority=10
postype=p2
pos=(target,const(size.ground.front)-2),-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
ontop = 1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 3302, Guard Sparks back]
type=explod
triggerall = Anim=2102
trigger1= moveguarded=1
anim=7010
sprpriority=10
postype=p2
pos=-(target,const(size.ground.back)-5),-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
ontop = 1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 0, VarSet] ;interrupt frozen
type = ParentVarSet
trigger1 = enemy,prevstateno=6876
trigger1 = enemy,movetype=H
var(35) = 0
ignorehitpause = 1
;persistent =

[State 820, EnvShake]
type = null ;EnvShake
trigger1 = movehit
time = 14
ampl = -4
freq = 120
ignorehitpause=1



[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = pos x!=[-350,350]
trigger2 = NumHelper(19875)>0
id =  2102
;ignorehitpause =
;persistent =

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = pos x!=[-350,350]
id =  7200
;ignorehitpause =
;persistent =


[State 3302, End]
type = destroyself
trigger1 = pos x!=[-400,400]


;-----------------------------------------
;Yakon GETHIT
[Statedef 2102]
type=A
movetype=I
physics=N
velset=0,0
ctrl=0
sprpriority=-5

[State 0, Pause]
type = Pause
trigger1 = !time
time = 0
movetime = 0
pausebg = 0

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !time
id = 2100
ignorehitpause = 1
;persistent =

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !time
id = 2101
ignorehitpause = 1
;persistent =

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !time
id = 7200
ignorehitpause = 1
;persistent =

[State 33021, anim]
type = changeanim
trigger1 = !time
value = 2103


[State 3302, NoShadow]
type = AssertSpecial
trigger1 = 1
flag = noshadow
flag2 = noBG
flag3 = noFG
ignorehitpause = 1

[State 0, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 0
movecamera = 0,0
ignorehitpause = 1
;persistent =

[State 0, EnvColor]
type = EnvColor
trigger1 = 1
value = 0,0,0
time = 1
under = 0
ignorehitpause = 1
;persistent =

[State 33021, nothitby]
type = nothitby
trigger1 = 1
time = 1
value = SCA
ignorehitpause = 1


[State 33021, End with Zzyzzyxx fix]
type= destroyself
trigger1 = !animtime

;-------------------------------------------------------------------------------
;PUI-PUI Special HELPER
[Statedef 2200]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 5

[State 0, Width]
type = Width
trigger1 = 1
value = 20,20
ignorehitpause = 1

[State 3121, PlaySnd]  ;teleport SFX
type = PlaySnd
trigger1 = !time
value = 2302,0

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 2200

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2204
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = AnimElemTime(3)<0
flag =  noshadow


[State 0, ChangeState]
type = ChangeState
trigger1 = !animtime
value = 2201
ctrl = 0
;anim =
;ignorehitpause =
;persistent=

;PUI-PUI Special ATTACK HELPER
[Statedef 2201]
type = A
movetype = A
physics = N
ctrl = 0
sprpriority = 5

[State 0, Width]
type = Width
trigger1 = 1
value = 30,20
ignorehitpause = 1

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 2201

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2204
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 200, 1]
type = PlaySnd
trigger1 = AnimElemTime(2)=0
trigger2 = AnimElemTime(3)=0
trigger3 = AnimElemTime(4)=0
value = 0, random%3

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(2)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6
guard.pausetime = 1,6
sparkno = s7010+10*(random%3)  ;s7030
guard.sparkno = s7000
sparkxy = -17,-60
hitsound = s5, random%3
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= ifelse(p2movetype=H,20,140), 5
givepower = 8,8
yaccel = 0.5

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(3)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6 ;8,8
guard.pausetime = 1,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -17,-73
hitsound = s5, random%3
guardsound = S6,1
ground.type = High
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= ifelse(p2movetype=H,10,140), 5
givepower = 8,8
yaccel = 0.5

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(4)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6 ;8,8
guard.pausetime = 1,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -10,-70
hitsound = s5, random%3
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= ifelse(p2movetype=H,10,140), 5
givepower = 8,8
yaccel = 0.5

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(5)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6 ;8,8
guard.pausetime = 1,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -23,-57
hitsound = s5, random%3
guardsound = S6,1
ground.type = High
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= ifelse(p2movetype=H,10,140), 5
givepower = 8,8
yaccel = 0.5

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(6)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6 ;8,8
guard.pausetime = 1,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -15,-70
hitsound = s5, random%3
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= ifelse(p2movetype=H,10,140), 5
givepower = 8,8
yaccel = 0.5

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(7)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6 ;8,8
guard.pausetime = 1,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -25,-60
hitsound = s5, random%3
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= ifelse(p2movetype=H,10,140), 5
givepower = 8,8
yaccel = 0.5

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(8)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6
guard.pausetime = 1,6
sparkno = s7010+10*(random%3)  ;s7030
guard.sparkno = s7000
sparkxy = -17,-60
hitsound = s5, random%3
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= ifelse(p2movetype=H,20,140), 5
givepower = 8,8
yaccel = 0.5

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(9)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6 ;8,8
guard.pausetime = 1,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -17,-73
hitsound = s5, random%3
guardsound = S6,1
ground.type = High
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= ifelse(p2movetype=H,10,140), 5
givepower = 8,8
yaccel = 0.5

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(10)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,8 ;8,8
guard.pausetime = 1,8 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -10,-70
hitsound = s5, random%3
guardsound = S6,1
ground.type = Low
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = 1
ground.cornerpush.veloff = 0.3
guard.velocity = -3.5
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= ifelse(p2movetype=H,10,140), 5
givepower = 8,8
yaccel = 0.5



[State 0, ChangeState]
type = ChangeState
trigger1 = !animtime
value = 2203
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

;-----------------------------------------
;PUI-PUI Special leaves
[Statedef 2203]
type=A
movetype=I
physics=N
ctrl=0
sprpriority=5

[State 0, Width]
type = Width
trigger1 = 1
value = 20,20
ignorehitpause = 1

[State 33021, nothitby]
type = nothitby
trigger1 = 1
time = 1
value = SCA
ignorehitpause = 1

[State 33021, anim]
type = changeanim
trigger1 = !time
value = 2203

[State 0, VelSet]
type = VelSet
trigger1 = AnimElemTime(2)=0 ;!time
x = -2.5
y = -3
;ignorehitpause =
;persistent =

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = AnimElemTime(3)>=0
flag =  noshadow

[State 0, VelSet]
type = VelSet
trigger1 = AnimelemTime(3)=0
x = 0
y = 0
;ignorehitpause =
;persistent =

[State 3121, PlaySnd]  ;teleport SFX
type = PlaySnd
trigger1 = AnimElem = 3
value = 2302,0
persistent = 0

[State 33021, End with Zzyzzyxx fix]
type= destroyself
trigger1 = !animtime

;-----------------------------------------
;PUI-PUI Special GETHIT
[Statedef 2204]
type=A
movetype=I
physics=N
velset=0,0
ctrl=0
sprpriority=5

[State 0, Width]
type = Width
trigger1 = 1
value = 20,20
ignorehitpause = 1

[State 33021, anim]
type = changeanim
trigger1 = !time
value = 2204

[State 33021, nothitby]
type = nothitby
trigger1 = 1
time = 1
value = SCA
ignorehitpause = 1


[State 33021, End with Zzyzzyxx fix]
type= destroyself
trigger1 = !animtime

;-------------------------------------------------------------------------------
;EX PUI-PUI Sp HELPER
[Statedef 2210]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 5

[State 2210, Stay on-screen]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,0
ignorehitpause = 1


[State 0, Width]
type = Width
trigger1 = 1
value = 50,20
ignorehitpause = 1

[State 3121, PlaySnd]  ;teleport SFX
type = PlaySnd
trigger1 = !time
value = 2302,0

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 2200

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2204
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 0, ChangeState]
type = ChangeState
trigger1 = !animtime
value = 2211
ctrl = 0
;anim =
;ignorehitpause =
;persistent=

;EX PUI-PUI Sp P1
[Statedef 2211]
type = A
movetype = A
physics = N
ctrl = 0
sprpriority = 5

[State 2210, Stay on-screen]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,0
ignorehitpause = 1

[State 3120, snd]
type = playsnd
trigger1 = !time
value = 7,0
channel = 1

[State 3120, flash]
type = PalFX
trigger1 = 1
add = 40, 30, -40
time=1
ignorehitpause = 1

[State 3120, Train]
type = AfterImage
trigger1 = Time = 0
time = 100 ;20
palbright = 40,30,-40
palcontrast = 256,206,206
trans = add1
ignorehitpause = 1

[State 0, Width]
type = Width
trigger1 = 1
value = 50,20
ignorehitpause = 1

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 2211

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2204
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 200, 1]
type = PlaySnd
trigger1 = AnimElemTime(2)=0
trigger2 = AnimElemTime(3)=0
trigger3 = AnimElemTime(4)=0
value = 0, random%3

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(2)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6
guard.pausetime = 1,6
sparkno = s7010+10*(random%3)  ;s7030
guard.sparkno = s7000
sparkxy = -17,-60
hitsound = s5, random%3
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.5

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(3)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6 ;8,8
guard.pausetime = 1,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -17,-73
hitsound = s5, random%3
guardsound = S6,1
ground.type = High
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = -1
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.5

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(4)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6 ;8,8
guard.pausetime = 1,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -10,-70
hitsound = s5, random%3
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = -8
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.5


[State 0, ChangeState]
type = ChangeState
triggerall = movehit
trigger1 = !animtime
value = 2212
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

[State 0, ChangeState]
type = ChangeState
triggerall = !movehit
trigger1 = !animtime
value = 2216
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

;EX PUI-PUI Sp TPT 1
[Statedef 2212]
type = A
movetype = A
physics = N
ctrl = 0
sprpriority = 5

[State 2210, Stay on-screen]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,0
ignorehitpause = 1

[State 0, Width]
type = Width
trigger1 = 1
value = 50,20
ignorehitpause = 1

[state -3, remove afterimage]
type = afterimagetime
trigger1 = !time
time = 0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[State 0, PosAdd]
type = PosAdd
trigger1 = AnimElemTime(3)=0
x = 40
;ignorehitpause =
;persistent =

[State 3121, PlaySnd]  ;teleport SFX
type = PlaySnd
trigger1 = AnimElemTime(3)=0
value = 2302,0

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 2210

[State 0, ChangeState]
type = ChangeState
trigger1 = !animtime
value = 2213
ctrl = 0


;EX PUI-PUI Sp P2
[Statedef 2213]
type = A
movetype = A
physics = N
ctrl = 0
sprpriority = 5

[State 2210, Stay on-screen]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,0
ignorehitpause = 1

[State 3120, flash]
type = PalFX
trigger1 = 1
add = 40, 30, -40
time=1
ignorehitpause = 1

[State 3120, Train]
type = AfterImage
trigger1 = Time = 0
time = 100 ;20
palbright = 40,30,-40
palcontrast = 256,206,206
trans = add1
ignorehitpause = 1

[State 0, Width]
type = Width
trigger1 = 1
value = 50,20
ignorehitpause = 1

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 2211

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2204
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 200, 1]
type = PlaySnd
trigger1 = AnimElemTime(2)=0
trigger2 = AnimElemTime(3)=0
trigger3 = AnimElemTime(4)=0
value = 0, random%3

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(2)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6
guard.pausetime = 1,6
sparkno = s7010+10*(random%3)  ;s7030
guard.sparkno = s7000
sparkxy = -17,-60
hitsound = s5, random%3
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.5

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(3)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6 ;8,8
guard.pausetime = 1,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -17,-73
hitsound = s5, random%3
guardsound = S6,1
ground.type = High
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = -1
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.5

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(4)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6 ;8,8
guard.pausetime = 1,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -10,-70
hitsound = s5, random%3
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = -10
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.5


[State 0, ChangeState]
type = ChangeState
triggerall = movehit
trigger1 = !animtime
value = 2214
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

[State 0, ChangeState]
type = ChangeState
triggerall = !movehit
trigger1 = !animtime
value = 2216
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

;EX PUI-PUI Sp TPT 2
[Statedef 2214]
type = A
movetype = A
physics = N
ctrl = 0
sprpriority = 5

[State 2210, Stay on-screen]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,0
ignorehitpause = 1

[State 0, Width]
type = Width
trigger1 = 1
value = 50,20
ignorehitpause = 1

[state -3, remove afterimage]
type = afterimagetime
trigger1 = !time
time = 0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[State 0, PosAdd]
type = PosAdd
trigger1 = AnimElemTime(3)=0
x = 40
;ignorehitpause =
;persistent =

[State 3121, PlaySnd]  ;teleport SFX
type = PlaySnd
trigger1 = AnimElemTime(3)=0
value = 2302,0

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 2210

[State 0, ChangeState]
type = ChangeState
trigger1 = !animtime
value = 2215
ctrl = 0

;EX PUI-PUI Sp P3
[Statedef 2215]
type = A
movetype = A
physics = N
ctrl = 0
sprpriority = 5

[State 2210, Stay on-screen]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,0
ignorehitpause = 1

[State 3120, flash]
type = PalFX
trigger1 = 1
add = 40, 30, -40
time=1
ignorehitpause = 1

[State 3120, Train]
type = AfterImage
trigger1 = Time = 0
time = 100 ;20
palbright = 40,30,-40
palcontrast = 256,206,206
trans = add1
ignorehitpause = 1

[State 0, Width]
type = Width
trigger1 = 1
value = 50,20
ignorehitpause = 1

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 2211

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2204
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 200, 1]
type = PlaySnd
trigger1 = AnimElemTime(2)=0
trigger2 = AnimElemTime(3)=0
trigger3 = AnimElemTime(4)=0
value = 0, random%3

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(2)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6
guard.pausetime = 1,6
sparkno = s7010+10*(random%3)  ;s7030
guard.sparkno = s7000
sparkxy = -17,-60
hitsound = s5, random%3
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.5

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(3)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6 ;8,8
guard.pausetime = 1,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -17,-73
hitsound = s5, random%3
guardsound = S6,1
ground.type = High
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = -1
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.5

[State 200, 1]
type = HitDef
trigger1 = AnimElemTime(4)=0
attr = S, NA
damage = 8, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,6 ;8,8
guard.pausetime = 1,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -10,-70
hitsound = s5, random%3
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = -3
ground.cornerpush.veloff = 0.3
guard.velocity = -3
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.5


[State 0, ChangeState]
type = ChangeState
trigger1 = !animtime
value = 2216
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

;EX PUI-PUI Sp ENDER HELPER
[Statedef 2216]
type = A
movetype = A
physics = N
ctrl = 0
sprpriority = 5

[State 2210, Stay on-screen]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,0
ignorehitpause = 1

[state -3, remove afterimage]
type = afterimagetime
trigger1 = !time
time = 0

[State 0, Width]
type = Width
trigger1 = 1
value = 50,20
ignorehitpause = 1

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 2202

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2204
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 420, 3]
type = HitDef
trigger1 = AnimElem = 3
attr = S, NA
damage = 38,0
hitflag = MAF
guardflag = MA
priority = 4, Hit
pausetime = 15,15
guard.pausetime = 15,15
sparkno = s7030
guard.sparkno = s7000
sparkxy = -20,-65
hitsound   = s5, 2
guardsound = S6,1
animtype = Up
ground.type = High
ground.slidetime = 12
ground.hittime = 12
ground.velocity = -1,-11.5
guard.velocity = -9
air.velocity = ifelse(p2movetype=H,-3,-1),ifelse(p2movetype=H,-5,-10)
fall = 1
air.animtype = back
getpower= 0,0
givepower = 35,35
yaccel = 0.45

[State 0, ChangeState]
type = ChangeState
trigger1 = !animtime
value = 2203
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

;-------------------------------------------------------------------------------
;DARBURA Lv.1 HELPER
[Statedef 2301]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 0

[State 0, Width]
type = Width
trigger1 = 1
value = 20,20
ignorehitpause = 1

[State 3121, PlaySnd]  ;teleport SFX
type = PlaySnd
trigger1 = !time
value = 2302,0

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 2301

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2302
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = AnimElemTime(3)<0
flag =  noshadow

[State 3010, Helper]
type = Helper
;triggerall = !NumHelper(2305)
;trigger1 = AnimElemTime(4)=0
;trigger2 = AnimElemTime(4)>0
trigger1 = time =10
trigger2 = time =35
trigger3 = time =60
trigger4 = time =85
helpertype = normal
name = "Darbura FB"
ID =   2305
stateno = 2305
pos = 85,-30
postype = p1
facing = 1
keyctrl = 0
ownpal = 1
supermovetime = 0
pausemovetime = 0


[State 0, ChangeState]
type = ChangeState
trigger1 = time = 100 ;!animtime
value = 2302
ctrl = 0
;anim =
;ignorehitpause =
;persistent=

;-----------------------------------------
;DARBURA Lv.1 leaves
[Statedef 2302]
type=A
movetype=I
physics=N
ctrl=0
sprpriority=0

[State 0, Width]
type = Width
trigger1 = 1
value = 20,20
ignorehitpause = 1

[State 33021, nothitby]
type = nothitby
trigger1 = 1
time = 1
value = SCA
ignorehitpause = 1

[State 33021, anim]
type = changeanim
trigger1 = !time
value = 2302

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag =  noshadow

[State 3121, PlaySnd]  ;teleport SFX
type = PlaySnd
trigger1 = !time
value = 2302,0
persistent = 0

[State 33021, End with Zzyzzyxx fix]
type= destroyself
trigger1 = !animtime

; Darbura FB
[Statedef 2305]
type    = S
movetype= A
physics = N
anim = 2304
sprpriority = -5
hitcountpersist = 1
movehitpersist = 1

[State 3020, NoShadow]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[State 3020, Transparency]
type = Trans
trigger1 = root,var(2)=0
trans = none
ignorehitpause = 1


[State 3020, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NA, SA, HA, NT, ST, HT
ignorehitpause = 1

[State 3020, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3020, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2306
attr = SCA, NP, SP, HP
ignorehitpause = 1

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = Anim=2304
trigger1 = !animtime
value = 2305
;elem = 1
;ignorehitpause =
;persistent =

[State 0, SprPriority]
type = SprPriority
trigger1 = Anim=2305
value = 5
;ignorehitpause =
;persistent =

[State 0, VelSet]
type = VelSet
trigger1 = Anim=2305
trigger1 = Animelemtime(1)=0
x = 4
y = 4
;ignorehitpause =
;persistent =

[State 3020, Hitdef]
type = HitDef
trigger1 = 1
attr = S, HP
animtype = Back
air.animtype = Back
fall.animtype = Back
damage    = ceil(30*root,fvar(12)), ceil(3*root,fvar(12))
priority  = 4,Hit
guardflag = MA
hitflag = MAFD
pausetime = 0,10
guard.pausetime = 2,1
sparkno = -1 ;s7010
guard.sparkno = -1
sparkxy = 0,-50
hitsound   = s2301,0
guardsound = S6,1
ground.type = High
air.type = Low
ground.hittime = 16
ground.slidetime = 16
guard.slidetime = 7
guard.hittime = 16
air.hittime = 13
airguard.ctrltime = 16
ground.velocity = -2,-2
guard.velocity = -2
air.velocity = -2,-5
airguard.velocity = -2, -2
envshake.time = 5
envshake.ampl = 4
envshake.freq = 176
fall.envshake.time = 10
fall.envshake.ampl = 4
fall.envshake.freq = 176
yaccel = 0.5
fall=1
air.fall = 1
fall.recover = 0
fall.recovertime = 13
forcestand = 1
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
down.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
getpower= 0,0
givepower = 35,35
;palfx.sinadd=64,64,64,4
;palfx.mul=128,128,128
;palfx.time=32
palfx.add = 255,50,0
palfx.sinadd = -255,-50,0,20
palfx.time = 25
persistent = 0


[State 3020, Sparks]
type=explod
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim=7020
sprpriority=7
postype=p2
pos=(target,const(size.ground.front)-2),-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 3020, Guard Sparks]
type=explod
trigger1= moveguarded
anim=7010
sprpriority=7
postype=p2
pos=(target,const(size.ground.front)-2),-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100


[state 3020, Flame overlay]
type = helper
triggerall = !NumHelper(9990)
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
pos = 0,0
postype = left
ID = 9990
stateno = 9990
helpertype = normal
name = "Fire"
sprpriority = -5
ownpal = 1
ignorehitpause = 1


[State 3020, Guardshake]
type = envshake
trigger1 = moveguarded
time = 4
ampl = 6
freq = 176
ignorehitpause = 1


[State 3055, end]
type = PlaySnd
trigger1 = pos y >= -15
value = s1000,0
persistent = 0

[State 1061, Fade]
type = changestate
trigger1 = movecontact
trigger2 = pos Y >= -15
value = 2306
ignorehitpause=1

[State 1061, End]
type = destroyself
trigger1 = (pos y!=[-10000,240])
trigger2 = time>180

;-------------------------------------------------------------------------------
;Darbura FB Vanish
[Statedef 2306]
type    = S
movetype= A
physics = N
velset=0,0
anim = 2306
ctrl=0
sprpriority=5
hitcountpersist = 1
movehitpersist = 1

[State 0, PosSet]
type = PosSet
trigger1 = !time
y = 0
;ignorehitpause =
;persistent =



[State 3021, NoShadow]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1


[State 3021, nothitby]
type = nothitby
trigger1 = 1
time = 1
value = SCA
ignorehitpause = 1

[State 3021, Transparency]
type = Trans
trigger1 = root,var(2)=0
trans = none
ignorehitpause = 1

[State 3020, Hitdef]
type = HitDef
trigger1 = 1
attr = S, HP
animtype = Back
air.animtype = Back
fall.animtype = Back
damage    = ceil(15*root,fvar(12)), ceil(2*root,fvar(12))
priority  = 4,Hit
guardflag = MA
hitflag = MAFD
pausetime = 0,10
guard.pausetime = 2,1
sparkno = -1 ;s7010
guard.sparkno = -1
sparkxy = 0,-50
hitsound   = -1 ;s2301,0
guardsound = -1 ;S6,1
ground.type = High
air.type = Low
ground.hittime = 16
ground.slidetime = 16
guard.slidetime = 7
guard.hittime = 16
air.hittime = 13
airguard.ctrltime = 16
ground.velocity = -2,-2
guard.velocity = -2
air.velocity = -2,-5
airguard.velocity = -2, -2
envshake.time = 5
envshake.ampl = 4
envshake.freq = 176
fall.envshake.time = 10
fall.envshake.ampl = 4
fall.envshake.freq = 176
yaccel = 0.5
fall=1
air.fall = 1
fall.recover = 0
fall.recovertime = 13
forcestand = 1
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
down.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
getpower= 0,0
givepower = 35,35
;palfx.sinadd=64,64,64,4
;palfx.mul=128,128,128
;palfx.time=32
palfx.add = 255,50,0
palfx.sinadd = -255,-50,0,20
palfx.time = 25
persistent = 0

[State 200, burn]
type = PlaySnd
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
value = 2301,0
volume = 300
persistent = 0

[state 3020, Flame overlay]
type = helper
triggerall = !NumHelper(9990)
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
pos = 0,0
postype = left
ID = 9990
stateno = 9990
helpertype = normal
name = "Fire"
sprpriority = -5
ownpal = 1
ignorehitpause = 1

[State 3021, End]
type= destroyself
trigger1 = !animtime

;-------------------------------------------------------------------------------
;DARBURA Lv.2 HELPER
[Statedef 2351]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 0

[State 0, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 0
movecamera = 0,0
ignorehitpause = 1
;persistent =


[State 0, Width]
type = Width
trigger1 = 1
value = 20,20
ignorehitpause = 1

[State 3121, PlaySnd]  ;teleport SFX
type = PlaySnd
trigger1 = !time
value = 2302,0

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 2303

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2302
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = AnimElemTime(3)<0
flag =  noshadow

[State 0, VelSet]
type = VelSet
trigger1 = !time
x = 8
;ignorehitpause =
;persistent =


[State 3010, Helper]
type = Helper
trigger1 = gametime%7=0
helpertype = normal
name = "Darbura B52"
ID =   2353
stateno = 2353
pos = 85,-30
postype = p1
facing = 1
keyctrl = 0
ownpal = 1
supermovetime = 0
pausemovetime = 0


[State 1061, End]
type = destroyself
trigger1 = (pos x!=[-400,400])
trigger2 = time>180

;DARBURA Shield
[Statedef 2352]
type = A
movetype = I
physics = N
ctrl = 0
anim = 2352
velset = 0,0
sprpriority = -10

[State 905, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = NoShadow

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = 1 ;Time >= 0
time = 1
value = SCA, NA, SA, HA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2352
attr = SCA, NP, SP, HP
ignorehitpause = 1

[State 0, BindToRoot]
type = BindToRoot
trigger1 = 1
time = 1
pos = -2,-33
ignorehitpause = 1
;persistent =

[State 0, Explod]
type = Explod
trigger1 = !time
anim = 6120
ID = 6120
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = -1
vel = 0,0
accel = 0,0
random = 0,0
removetime = -1
pausemovetime = 0
scale = 1,1
sprpriority = 1
ontop = 0
shadow = 0,0,0
ownpal = 0
removeongethit = 0
ignorehitpause = 1
trans = addalpha
alpha = 128,128 ;200,128 ;64,128
;persistent =
;supermove = 0
;pausemove = 0

[State 0, VarAdd]
type = VarAdd
trigger1 = !time
var(1) = 1
;ignorehitpause =
;persistent =


[State 0, spark]
type = Explod
triggerall = !NumExplod(6121)
trigger1 = !time
trigger1 = var(1)>1
anim = 6121
ID = 6121
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = -1
vel = 0,0
accel = 0,0
random = 0,0
removetime = -2
pausemovetime = 0
scale = 1,1
sprpriority = 10
ontop = 0
shadow = 0,0,0
ownpal = 0
removeongethit = 0
ignorehitpause = 1
;trans = addalpha
;alpha = 128,128 ;200,128 ;64,128
;persistent = 0
;supermove = 0
;pausemove = 0


[State 0, Enegy FX]
type = PalFX
trigger1 = !time
trigger1 = var(1)>1
time = 2
add = 100,100,100
mul = 256,256,256
sinadd = -80,-80,-80,10
invertall = 0
color = 256
ignorehitpause = 1
;persistent = 0

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = Root,stateno != 2350
id = 6120
ignorehitpause = 1
;persistent =


[State 905, DestroySelf]
type = DestroySelf
trigger1 = Root,stateno != 2350

; Darbura B52 Bomb
[Statedef 2353]
type    = S
movetype= A
physics = N
anim = 2307
sprpriority = 5
hitcountpersist = 1
movehitpersist = 1

[State 3020, NoShadow]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[State 3020, Transparency]
type = Trans
trigger1 = root,var(2)=0
trans = none
ignorehitpause = 1


[State 3020, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NA, SA, HA, NT, ST, HT
ignorehitpause = 1

[State 3020, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3020, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2354
attr = SCA, NP, SP, HP
ignorehitpause = 1



[State 0, VelSet]
type = VelSet
trigger1 = !time
x = 3
y = 3
;ignorehitpause =
;persistent =

[State 0, VelAdd]
type = VelAdd
trigger1 = vel x >=0
x = -0.2
;ignorehitpause =
;persistent =


[State 3020, Hitdef]
type = HitDef
trigger1 = 1
attr = S, HP
animtype = Back
air.animtype = Back
fall.animtype = Back
damage    = ceil(85*root,fvar(12)), ceil(8*root,fvar(12))
priority  = 4,Hit
guardflag = MA
hitflag = MAFD
affectteam = B
pausetime = 0,10
guard.pausetime = 2,1
sparkno = -1 ;s7010
guard.sparkno = -1
sparkxy = 0,-50
hitsound   = s2301,0
guardsound = S6,1
ground.type = High
air.type = Low
ground.hittime = 16
ground.slidetime = 16
guard.slidetime = 7
guard.hittime = 16
air.hittime = 13
airguard.ctrltime = 16
ground.velocity = -2,-2
guard.velocity = -2
air.velocity = -2,-5
airguard.velocity = -2, -2
envshake.time = 5
envshake.ampl = 4
envshake.freq = 176
fall.envshake.time = 10
fall.envshake.ampl = 4
fall.envshake.freq = 176
yaccel = 0.5
fall=1
air.fall = 1
fall.recover = 0
fall.recovertime = 13
forcestand = 1
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
down.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
getpower= 0,0
givepower = 35,35
;palfx.sinadd=64,64,64,4
;palfx.mul=128,128,128
;palfx.time=32
palfx.add = 255,50,0
palfx.sinadd = -255,-50,0,20
palfx.time = 25
persistent = 0


[State 3020, Sparks]
type=explod
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim=7020
sprpriority=7
postype=p2
pos=(target,const(size.ground.front)-2),-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 3020, Guard Sparks]
type=explod
trigger1= moveguarded
anim=7010
sprpriority=7
postype=p2
pos=(target,const(size.ground.front)-2),-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100


[State 3020, Guardshake]
type = envshake
trigger1 = moveguarded
time = 4
ampl = 6
freq = 176
ignorehitpause = 1


[State 3055, end]
type = PlaySnd
trigger1 = pos y >= -5
value = s1000,0
persistent = 0

[State 1061, Fade]
type = changestate
trigger1 = movecontact
trigger2 = pos Y >= -5
value = 2354
ignorehitpause=1

[State 1061, End]
type = destroyself
trigger1 = (pos y!=[-10000,240])
trigger2 = time>180

;-------------------------------------------------------------------------------
;Darbura B52 Bomb Vanish
[Statedef 2354]
type    = S
movetype= A
physics = N
velset=0,0
anim = 2308
ctrl=0
sprpriority=5


[State 3021, NoShadow]
type = AssertSpecial
trigger1 = 1
flag = noshadow
flag2 = invisible
ignorehitpause = 1

[State 3321, Sound]
type = PlaySnd
trigger1 = !time
value = 3300, 1

[State 0, Explod]
type = Explod
triggerall = !NumExplod(2308)
trigger1 = !time
anim = 2308
ID = 2308
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = -1
vel = 0,0
accel = 0,0
random = 0,0
removetime = -1
pausemovetime = 0
scale = 0.5,0.5
sprpriority = 5
ontop = 1
shadow = 0,0,0
ownpal = 1
removeongethit = 1
ignorehitpause = 1
;trans =
;persistent =
;supermove = 0
;pausemove = 0

[State 3021, nothitby]
type = nothitby
trigger1 = 1
time = 1
value = SCA
ignorehitpause = 1

[State 3021, Transparency]
type = Trans
trigger1 = root,var(2)=0
trans = none
ignorehitpause = 1

[State 3020, Hitdef]
type = HitDef
trigger1 = 1
attr = S, HP
animtype = Back
air.animtype = Back
fall.animtype = Back
damage    = ceil(70*root,fvar(12)), ceil(7*root,fvar(12))
priority  = 4,Hit
guardflag = MA
hitflag = MAFD
affectteam = E
pausetime = 0,10
guard.pausetime = 2,1
sparkno = -1 ;s7010
guard.sparkno = -1
sparkxy = 0,-50
hitsound   = -1 ;s2301,0
guardsound = -1 ;S6,1
ground.type = High
air.type = Low
ground.hittime = 16
ground.slidetime = 16
guard.slidetime = 7
guard.hittime = 16
air.hittime = 13
airguard.ctrltime = 16
ground.velocity = -2,-2
guard.velocity = -2
air.velocity = -2,-5
airguard.velocity = -2, -2
envshake.time = 5
envshake.ampl = 4
envshake.freq = 176
fall.envshake.time = 10
fall.envshake.ampl = 4
fall.envshake.freq = 176
yaccel = 0.5
fall=1
air.fall = 1
fall.recover = 0
fall.recovertime = 13
forcestand = 1
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
down.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
getpower= 0,0
givepower = 35,35
;palfx.sinadd=64,64,64,4
;palfx.mul=128,128,128
;palfx.time=32
palfx.add = 255,50,0
palfx.sinadd = -255,-50,0,20
palfx.time = 25
persistent = 0

[State 200, burn]
type = PlaySnd
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
value = 2301,0
volume = 300
persistent = 0

[state 3020, Flame overlay]
type = helper
triggerall = !NumHelper(9990)
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
pos = 0,0
postype = left
ID = 9990
stateno = 9990
helpertype = normal
name = "Fire"
sprpriority = -5
ownpal = 1
ignorehitpause = 1

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !animtime
id = 2308
;ignorehitpause =
;persistent =


[State 3021, End]
type= destroyself
trigger1 = !animtime


;-------------------------------------------------------------------------------
;Sticky Bomb Base
[Statedef 2400]
type = A
movetype = A
physics = N
ctrl = 0
sprpriority = 5

[State 0, Cursed flag detection]
type = ParentVarSet
trigger1 = !time
var(49) = 3
;ignorehitpause =
;persistent =

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag =  noshadow

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6300

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NA, SA, HA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2404
attr = SCA, NP, SP, HP
ignorehitpause = 1

[State 0, VelSet LK]
type = VelSet
triggerall = root,var(15)=1
trigger1 =  !time
x = 2
y = -10
;ignorehitpause =
;persistent =

[State 0, VelSet MK]
type = VelSet
triggerall = root,var(15)=2
trigger1 =  !time
x = 3
y = -8
;ignorehitpause =
;persistent =

[State 0, VelSet SK]
type = VelSet
triggerall = root,var(15)>=3
trigger1 =  !time
x = 6
y = -6
;ignorehitpause =
;persistent =

[State 0, Gravity]
type = Gravity
trigger1 = 1
;ignorehitpause =
;persistent =

[State 3055, sound]
type = PlaySnd
trigger1 = time=2
value = 6300,0 ;5052,0
persistent = 0

[State 0, ParentVarSet]  ;Enemy state tracker
type = ParentVarSet
trigger1 = 1
;trigger1 = enemynear,movetype!=H
;trigger2 = enemynear,stateno!=[5000,5999]
var(41) = enemynear,stateno
ignorehitpause = 1
;persistent =

[State 0, ParentVarSet]  ;Enemy Anim tracker
type = ParentVarSet
trigger1 = 1
;trigger1 = enemynear,movetype!=H
;trigger2 = enemynear,stateno!=[5000,5999]
var(42) = enemynear,Anim
ignorehitpause = 1
;persistent =

[State 0, ParentVarSet]  ;Enemy AnimElemNo tracker
type = ParentVarSet
trigger1 = 1
;trigger1 = enemynear,movetype!=H
;trigger2 = enemynear,stateno!=[5000,5999]
var(43) = enemynear,AnimElemno(0)
ignorehitpause = 1
;persistent =


[State 200, 1]
type = HitDef
trigger1 = 1 && !(enemy,name="Saibamen") ;hack against Saibamen
attr = S, SP
damage = 0, 0
animtype = Light
guardflag = MA
hitflag = MAF ;D
priority = 4, Hit
pausetime = 0,0
guard.pausetime = 0,0
sparkno = -1 ;s7010+10*(random%3)  ;s7030
guard.sparkno = -1 ;s7000
sparkxy = -17,-60
hitsound = -1 ;s5, random%3
guardsound = -1 ;S6,1
ground.type = Low
ground.slidetime = 0
ground.hittime  = 0
ground.velocity = 0
ground.cornerpush.veloff = 0
guard.velocity = 0
airguard.velocity = 0,0
air.type = High
air.velocity = 0,0
air.hittime = 0
air.animtype = back
getpower= ifelse(p2movetype=H,20,140), 5
givepower = 8,8
yaccel = 0.5
numhits = 0
p1stateno = 2402
p2stateno = 2405
persistent = 0

[State 200, 1]
type = HitDef
trigger1 = 1 && (enemy,name="Saibamen") ;hack against Saibamen
attr = S, SP
damage = 0, 0
animtype = Light
guardflag = MA
hitflag = MAF ;D
priority = 4, Hit
pausetime = 0,0
guard.pausetime = 0,0
sparkno = -1 ;s7010+10*(random%3)  ;s7030
guard.sparkno = -1 ;s7000
sparkxy = -17,-60
hitsound = -1 ;s5, random%3
guardsound = -1 ;S6,1
ground.type = Low
ground.slidetime = 0
ground.hittime  = 0
ground.velocity = 0
ground.cornerpush.veloff = 0
guard.velocity = 0
airguard.velocity = 0,0
air.type = High
air.velocity = 0,0
air.hittime = 0
air.animtype = back
getpower= ifelse(p2movetype=H,20,140), 5
givepower = 8,8
yaccel = 0.5
numhits = 0
p1stateno = 2404
;p2stateno = 2405
persistent = 0


[State 0, VarSet]
type = VarSet
trigger1 = 1
fvar(1) = Screenpos X
ignorehitpause = 1
;persistent =

[State 0, VarSet]
type = VarSet
trigger1 = 1
fvar(2) = Screenpos Y
ignorehitpause = 1
;persistent =


[State 0, Explod]
type = Explod
trigger1 = !NumExplod(6301)
;trigger1 = time=10
anim = 6301
ID = 6301
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = 2
vel = 0,0
accel = 0,0
random = 0,0
removetime = -2
pausemovetime = 0
scale = 1,1
sprpriority = -2
ontop = 0
shadow = 0,0,0
ownpal = 0
removeongethit = 0
;ignorehitpause =
;trans =
;persistent =
;supermove = 0
;pausemove = 0

[State 0, ChangeState]
type = null;ChangeState
trigger1 = abs(Screenpos X) - abs(enemynear,Screenpos X) = [-(enemynear,Const(size.ground.front)),(enemynear,Const(size.ground.front))]  ;[-20,20]
trigger1 = abs(Screenpos Y) - abs(enemynear,Screenpos Y) = [-(enemynear,Const(size.height)),(enemynear,Const(size.height))] ;[-60,60]
value = 2402
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

[State 0, ChangeState]
type = null;ChangeState
trigger1= movehit
value = 2402
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

[State 0, ChangeState]
type = ChangeState
trigger1 = moveguarded
value = 2404
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

[State 0, Cursed flag detection]
type = ParentVarSet
trigger1 = pos y >=0
var(49) = 0
;ignorehitpause =
;persistent =



[State 0, ChangeState]
type = ChangeState
trigger1 = pos y >=0
value = 2401
ctrl = 0
;anim =
;ignorehitpause =
;persistent =



[State 0, RemoveExplod]
type = null;RemoveExplod
trigger1 = pos y >=0
id =6301
;ignorehitpause =
;persistent =


[State 0, DestroySelf]
type = DestroySelf
;trigger1 = pos y >=0
trigger1 = enemy,stateno=[6920,6927] ; remove when Curse Lv.3
ignorehitpause = 1
;persistent =

;Sticky Bomb whiff
[Statedef 2401]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 5

[State 0, Cursed flag detection]
type = ParentVarSet
trigger1 = !time
var(49) = 0
;ignorehitpause =
;persistent =

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag =  noshadow

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
ignorehitpause = 1

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6302

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !time
id = 6301
;ignorehitpause =
;persistent =

[State 0, VelSet]
type = VelSet
trigger1 = !time
x = 0
y = 0
;ignorehitpause =
;persistent =

[State 0, PosSet]
type = PosSet
trigger1 = !time
y = 0
;ignorehitpause =
;persistent =

[State 3055, sound]
type = PlaySnd
trigger1 = !time
value = 1000,0
persistent = 0

[State 0, DestroySelf]
type = DestroySelf
trigger1 = !animtime
;ignorehitpause =
;persistent =


;Sticky Bomb glued
[Statedef 2402]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 5


[State 0, Cursed flag detection]
type = ParentVarSet
trigger1= animtime<0 ;!time ;&& numtarget
var(49) = 4
ignorehitpause = 1
;persistent =

[State 0, P2 redirection]
type= null ;targetstate
trigger1= !time && numtarget
value= 2405

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag =  noshadow
flag2 = invisible

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
ignorehitpause = 1

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !time
id = 6301
;ignorehitpause =
;persistent =

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6303

[State 0, VelSet]
type = VelSet
trigger1 = !time
x = 0
y = 0
;ignorehitpause =
;persistent =

[State 0, PosSet 0]
type = PosSet
trigger1 = !time
x = -160+floor(fvar(1))
y =  floor(pos Y)
;ignorehitpause =
;persistent =

[State 0, Distance X]
type = VarSet
trigger1 = !time
fvar(3)= floor(pos X)-floor(enemynear,pos X)

[State 0, Distance Y]
type = VarSet
trigger1 = !time
fvar(4)= floor(pos Y)-floor(enemynear,pos Y)


[State 0, PosSet 1]
type = PosSet
trigger1 = time>0
x = -160+floor(enemynear,Screenpos X)+floor(fvar(3))
y = floor(enemynear,pos Y) + floor(fvar(4))
;ignorehitpause =
;persistent =


[State 0, Explod]
type = Explod
trigger1 = !time
anim = 6303
ID = 6303
pos = (enemynear,facing)*(floor(fvar(1))-floor(enemynear,Screenpos X)),floor(fvar(4))
postype = p2  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = -1
vel = 0,0
accel = 0,0
random = 0,0
removetime = -1
pausemovetime = 0
scale = 1,1
sprpriority = 10
ontop = 0
shadow = 0,0,0
ownpal = 0
removeongethit = 0
;ignorehitpause =
;trans =
;persistent =
;supermove = 0
;pausemove = 0

[State 3055, sound]
type = PlaySnd
trigger1 = !time
value = 6300,1
persistent = 0

;detonate
[State 0, ChangeState]
type = ChangeState
triggerall = time>0
trigger1 = root,stateno=1450
trigger1 = root,AnimElemtime(3)=0
value =  2403
ctrl = 0
;anim =
;ignorehitpause = 1
;persistent =

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = time=180
trigger2 = enemy,stateno=[6920,6927] ; remove when Curse Lv.3
id = 6303
;ignorehitpause =
;persistent =

[State 0, ChangeState]
type = ChangeState
trigger1 = time= 180 ;!animtime
value = 2406
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

[State 0, DestroySelf]
type = DestroySelf
;trigger1 = time= 180 ;!animtime
trigger1 = enemy,stateno=[6920,6927] ; remove when Curse Lv.3
ignorehitpause = 1
;persistent =

;Sticky Bomb Detonation
[Statedef 2403]
type = A
movetype = A
physics = N
ctrl = 0
sprpriority = 10
anim = 15999

[State 0, Cursed flag detection]
type = ParentVarSet
trigger1= !time ;&& numtarget
var(49) = 0
ignorehitpause = 1
;persistent =

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag =  noshadow
flag2 = invisible

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
ignorehitpause = 1

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !time
id = 6303
;ignorehitpause =
;persistent =

[State 3055, sound]
type = PlaySnd
trigger1 = !time
value = 6300,2
persistent = 0

[State 33021, Projectile]
type = Projectile
trigger1 = !time
ProjID =  6304
projanim = 6304
projhitanim = 6304
projscale = 1,1
projremovetime = 25
velocity = 0,0
remvelocity = 0,0
accel = 0,0
velmul = 1
projhits = 1
projpriority = 1
projsprpriority = 6
projedgebound = 40
projstagebound = 40
projheightbound = -240
;offset = 30,30
;postype = p1
offset = floor(fvar(3)),floor(fvar(4))
postype = p2  ;p2,front,back,left,right
projshadow = 0,0,0
supermovetime = 0
pausemovetime = 0
; HitDef
attr = SCA,NP,SP,HP        ;SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
hitflag = MAFD        ;HLAFD+-
;guardflag = MA         ;HLA
getpower = 0,0
givepower = 0,0
affectteam = E          ;B,E,F
animtype = hard          ;light,medium,hard,back,up,diagup
priority = 4,Hit   ;Hit,Miss,Dodge
damage = 40,4
pausetime = 0,0
guard.pausetime = 0,0
sparkno = 0
guard.sparkno = 0
sparkxy = 0,0
hitsound = S3300,2
;guardsound = S2511,0
ground.type = Low      ;Low,Trip,None
ground.velocity = -5,-2
air.velocity = -5,-2
fall = 1
fall.recover = 0
persistent = 0

[State 0, Combo keeper]
type = ChangeState
trigger1 = time>0
trigger1 = !NumProjID(6304)
value = 11111
ctrl = 0
ignorehitpause = 1
;persistent =

[State 0, DestroySelf]
type = DestroySelf
trigger1 = time>0
trigger1 = !NumProjID(6304)
trigger2 = enemy,stateno=[6920,6927] ; remove when Curse Lv.3
ignorehitpause = 1
;persistent =


;Sticky Bomb Guarded
[Statedef 2404]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 10

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
ignorehitpause = 1


[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag =  noshadow

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !time
id = 6301
;ignorehitpause =
;persistent =

[State 0, VelSet]
type = VelSet
trigger1 =  !time
x = -3
y = -3
;ignorehitpause =
;persistent =

[State 3055, end]
type = PlaySnd
trigger1 = !time
value = 2522,1
persistent = 0

[State 0, Gravity]
type = Gravity
trigger1 = 1
;ignorehitpause =
;persistent =


[State 0, ChangeState]
type = ChangeState
trigger1 = pos y >=0
value = 2401
ctrl = 0

;Sticky Bomb Dummy State
[Statedef 2405]
type = U
movetype = I
physics = U
ctrl = 0

[State 0, ChangeAnim2]
type = ChangeAnim
triggerall = NumEnemy
triggerall = enemy,name = "Babidi Z2"
trigger1 = !time
;value = enemy,var(42) ;Anim
;elem = enemy,var(43) ;1
value = anim
elem = animelemno(0)
ignorehitpause = 1
;persistent =

[State 0, Let it Go!]
type = ChangeState
triggerall = NumEnemy
triggerall = enemy,name = "Babidi Z2"
triggerall = enemy,NumHelper(8888)=1 ;Timer counter
trigger1 = !time
value = 6876  ;Frozen
ctrl = 0
;anim =
;ignorehitpause =
;persistent =


[State 2405, ChangeState]
type = SelfState
triggerall = NumEnemy
triggerall = enemy,name = "Babidi Z2"
;trigger1 =  !time
trigger1 =  !animtime ;!time
trigger2 = enemy,var(41)=0 && !time  ;stand idle fix
trigger3 = statetype=A && !time  ;jump fix
value = 0 + 11*(statetype=C) + (statetype=A)*(enemy,var(41));50*(statetype=A);enemy,var(41)
;anim = enemy,var(42) ;Anim
;elem = enemy,var(43) ;1
ctrl = 1

;Sticky Bomb Unglued
[Statedef 2406]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 10


[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
ignorehitpause = 1


[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag =  noshadow

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !time
id = 6301
;ignorehitpause =
;persistent =

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = 6300
;elem = 1
;ignorehitpause =
;persistent =


[State 0, VelSet]
type = VelSet
trigger1 =  !time
x = -2
y = -2
;ignorehitpause =
;persistent =

[State 3055, end]
type = PlaySnd
trigger1 = !time
value = 2522,1
persistent = 0

[State 0, Gravity]
type = Gravity
trigger1 = 1
;ignorehitpause =
;persistent =


[State 0, ChangeState]
type = ChangeState
trigger1 = pos y >=0
value = 2401
ctrl = 0

;PUI-PUI Lv1 HELPER
[Statedef 2601]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 5

[State 3121, PlaySnd]  ;teleport SFX
type = PlaySnd
trigger1 = !time
value = 2302,0

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 2200

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2204
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = AnimElemTime(3)<0
flag =  noshadow


[State 0, ChangeState]
type = ChangeState
trigger1 = !animtime
value = 2602
ctrl = 0

;PUI-PUI Lv1 CHARGE
[Statedef 2602]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 5

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 2212

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2204
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 3010, Helper]
type = Helper
triggerall = !NumHelper(2604)
trigger1 = AnimElemTime(4)=0
helpertype = normal
name = "Pui-Pui Missile"
ID = 2604
stateno = 2604
pos = 80,-48
postype = p1
facing = 1
keyctrl = 0
ownpal = 1
supermovetime = 0
pausemovetime = 0


[State 0, ChangeState]
type = ChangeState
trigger1 = NumHelper(2604)=1
trigger1 = Helper(2604),vel x>0
value = 2603
ctrl = 0

;PUI-PUI Lv1 RELEASE
[Statedef 2603]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 5


[State 3302, anim]
type = changeanim
trigger1 = !time
value = 2213

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
;trigger1 = 1
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2204
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[state 1215, Smoke FX]
type = explod
trigger1 = !time
anim = 1208;+(var(2)=0)
id = 1206
pos = -20,0
postype = p1    ;p2,front,back,left,right
facing = -1
vfacing = 1
sprpriority = 4
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 0

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = NumHelper(2604)=1
trigger1 = Helper(2604),stateno=2605
trigger1 = Anim=2213
value = 2215
;elem = 1
;ignorehitpause =
;persistent =

[state 19400, question mark]
type = explod
trigger1 = time=45
anim = 2216
id = 2216
pos = 0,-50
postype = P1
sprpriority = 8
ownpal = 1
removetime = 15
persistent = 0
scale = 1,1
facing = facing
bindtime = -1
removeongethit = 1


[State 0, ChangeState]
type = ChangeState
trigger1 = Anim=2215
trigger1 = !animtime
trigger2 = time>75
value = 2203
ctrl = 0

;PUI-PUI MISSILE
[Statedef 2604]
type    = S
movetype= A
physics = N
anim = 2214
sprpriority = 6
hitcountpersist = 1
movehitpersist = 1

[State 3320, charge sound]
type = PlaySnd
trigger1 = !time
value = 2614,0 ;733,2
channel = 5
persistent = 0

[State 3410, Charge shake]
type = envshake
trigger1 = !time
time = 12
ampl = 2
freq = 100
ignorehitpause = 1

[State 3410, NoShadow]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[State 3410, NoShadow]
type = Trans
trigger1 = root,var(2)=0
trans = none
ignorehitpause = 1

[State 3302, anim]
type = changeanim
trigger1 = anim = 2214
trigger1 = !animtime
value = 1315

[State 3410, Velocity]
type = VelSet
trigger1 = anim = 1315
trigger1 = AnimElemtime(1)=0
x = 8 ;17 ;16 ;8
;y = 0.0 + Tan(random%2) - Tan(random%2)

[State 3320, launch sound]
type = PlaySnd
trigger1 = vel x>0
value = 2400,11
channel = 5
persistent = 0


[State 3410, Velocity]
type = VelSet
trigger1 = Movehit
x = 0

[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NA, SA, HA, NT, ST, HT
ignorehitpause = 1

[State 3410, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3410, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2605
attr = SCA, NP, SP, HP
ignorehitpause = 1

[State 3410, Hitdef]
type = HitDef
trigger1 = 1
attr = S, HP
animtype  = hard
damage    = ceil(160*root,fvar(12)), ceil(16*root,fvar(12))
priority  = 4,Hit
guardflag = MA
hitflag = MAFD
pausetime = 2,10
guard.pausetime = 2,1
sparkno = -1 ;S3435 ;s7010
guard.sparkno = -1
sparkxy = 0,0
hitsound   = s1000,0
guardsound = S6,1
ground.type = low
air.type = low
ground.slidetime = 15
ground.hittime  = 15
ground.velocity = -7.8,-5 ;0
guard.velocity = -7.5
air.velocity = -5.8,-3
airguard.velocity = -5, -4
envshake.time = 5
envshake.ampl = 4
envshake.freq = 176
fall.envshake.time = 10
fall.envshake.ampl = 4
fall.envshake.freq = 176
yaccel = 0.5
fall=1
air.fall = 1
fall.recover = 0
fall.recovertime = 30
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
down.cornerpush.veloff = 0
airguard.cornerpush.veloff = 0
guard.cornerpush.veloff = 0
getpower = 0,0  ;ifelse(p2movetype=H,40,140), 10
givepower = 35,35

[State 3410, Guardshake]
type = envshake
trigger1 = moveguarded
time = 4
ampl = 6
freq = 176
ignorehitpause = 1

[State 3410, Fade]
type = changestate
trigger1 = movecontact
value = 2605
ignorehitpause=1

[State 3410, End]
type = destroyself
trigger1 = (pos x!=[-240,240])
trigger2 = time>180


;----------------------------------------------------
;PUI-PUI MISSILE Vanish
[Statedef 2605]
type    = S
movetype= A
physics = N
anim = 6000 ;1317
sprpriority = 6
velset = 0,0

[State 3411, NoShadow]
type = Trans
trigger1 = root,var(2)=0
trans = none
ignorehitpause = 1

[State 3411, NoJuggle Safety]
type = parentvarset
trigger1 = !time
v = 18
value = 0

[State 3320, explosion sound]
type = PlaySnd
trigger1 = !time
value = 2600,0 ;2511,0 ;2483,0
channel = 5
persistent = 0

[State 3411, NoShadow]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[State 3020, Sparks]
type=null ;explod
trigger1= !time
anim=6000
sprpriority=10
postype=p2
pos= (target,const(size.ground.front)-2),-50 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 3411, End]
type = destroyself
trigger1 = time = 54 ;animtime = 0


;Floating Bomb idle
[Statedef 2950]
type = A
movetype = I ;A ;I
physics = N
ctrl = 0
sprpriority = 10
juggle = 7
hitcountpersist = 1
movehitpersist = 1

[State 0, PosSet offscreen]
type = PosSet
trigger1 = Pos X>170
x = 170
ignorehitpause =1

[State 0, PosSet offscreen]
type = PosSet
trigger1 = Pos X<-170
x = -170
ignorehitpause =1

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
flag2 = noautoturn
ignorehitpause = 1
;persistent =

[State 33210, transparency]
type = Trans
trigger1 = root,var(2)=0
trans = none

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6400

[State 0, PlaySnd]
type = PlaySnd
trigger1 = !time
value = 6200,0
volume = 200
channel = -1

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NA, SA, HA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2955
attr = SCA, NP, SP, HP
ignorehitpause = 1

[State 0, AngleDraw]
type = AngleDraw
trigger1 = time<240
value = 0
scale = 0.5,0.5
ignorehitpause = 1
;persistent =

[State 0, AngleDraw]
type = AngleDraw
trigger1 = time>=240
value = 0
scale = 0.5-((time-240)/20.0),0.5-((time-240)/20.0)
ignorehitpause = 1
;persistent =

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = p2dist x=[-50,50]
movetype = A        ;I,A,H
ignorehitpause = 1
;persistent =

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = p2dist x!=[-50,50]
movetype = I        ;I,A,H
ignorehitpause = 1
;persistent =

[State 200, 1]
type = HitDef
trigger1 = 1
attr = S, SP
damage = 0, 0
animtype = Light
;guardflag = MA
hitflag = MAFD
priority = 4, Hit
pausetime = 0,0
guard.pausetime = 0,0
sparkno = -1 ;s7010+10*(random%3)  ;s7030
guard.sparkno = -1 ;s7000
sparkxy = -17,-60
hitsound = -1 ;s5, random%3
guardsound = -1 ;S6,1
ground.type = Low
ground.slidetime = 0
ground.hittime  = 0
ground.velocity = 0
ground.cornerpush.veloff = 0
guard.velocity = 0
airguard.velocity = 0,0
air.type = High
air.velocity = 0,0
air.hittime = 0
air.animtype = back
getpower= 0,0 ;ifelse(p2movetype=H,20,140), 5
givepower = 0,0 ;8,8
yaccel = 0.5
persistent = 0

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = Time=240
movetype = I        ;I,A,H
ignorehitpause = 1
;persistent =

[State 0, ChangeState]
type = ChangeState
trigger1= movecontact ;moveguarded
value = 2955
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

[State 0, DestroySelf]
type = DestroySelf
trigger1 = time = 250
trigger2 = enemy,stateno=[6920,6927] ; remove when Curse Lv.3
ignorehitpause = 1
;persistent =


;Floating Bomb Explosion
[Statedef 2955]
type = A
movetype = A
physics = N
ctrl = 0
sprpriority = 10
hitcountpersist = 1
movehitpersist = 1

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
;value2 = S,NA
time = 1
;ignorehitpause =
;persistent =


[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
flag2 = noautoturn
ignorehitpause = 1
;persistent =

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6405

[State 0, PlaySnd]
type = PlaySnd
trigger1 = !time
value = 6200,1
volume = 200
channel = -1

[State 420, 3]
type = HitDef
trigger1 = 1
attr = S, SA
damage = 38,0
hitflag = MAFD
;guardflag = MA
priority = 4, Hit
pausetime = 0,5
guard.pausetime = 0,5
sparkno = -1 ;s7030
guard.sparkno = -1 ;s7000
sparkxy = 0,0 ;-20,-65
hitsound   = s5, 2
guardsound = S6,1
animtype = Up
ground.type = High
ground.slidetime = 12
ground.hittime = 12
ground.velocity = IfElse(p2dist x>=0,-10,10),-4
ground.cornerpush.veloff = 0
guard.velocity = -9
air.velocity = IfElse(p2dist x>=0,-3,3),ifelse(p2movetype=H,-10,-5);ifelse(p2movetype=H,-3,-3),ifelse(p2movetype=H,-10,-5)
fall=1
air.fall = 1
fall.recover = 0
fall.recovertime = 30
air.animtype = back
getpower= ifelse(p2movetype=H,40,210), 35
givepower = 35,35
yaccel = 0.45
numhits = 0
persistent = 0


[State 10231, Superjump Sound]
type = playsnd
trigger1 = movecontact
value = 0,24
persistent = 0

[State 0, Combo keeper]
type = ChangeState
trigger1 = !animtime
value = 11111
ctrl = 0
ignorehitpause = 1
;persistent =


[State 0, DestroySelf]
type = DestroySelf
trigger1 = !animtime
;ignorehitpause =
;persistent =

;EX Floating Bomb idle
[Statedef 2960]
type = A
movetype = I ;A ;I
physics = N
ctrl = 0
sprpriority = 10

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
flag2 = noautoturn
flag3 = unguardable
ignorehitpause = 1
;persistent =


[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = time<2
flag = invisible
ignorehitpause = 1

[State 0, Red PalFX]
type = PalFX
trigger1 = 1
time = 1
add = 0,-200,-200
mul = 256,256,256
sinadd = 40,80,40,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 33210, transparency]
type = Trans
trigger1 = root,var(2)=0
trans = none

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6400

[State 0, PlaySnd]
type = PlaySnd
trigger1 = !time
value = 6200,0
volume = 200
channel = -1

[State 3302, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NA, SA, HA, NT, ST, HT
ignorehitpause = 1

[State 3302, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3302, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 2955
attr = SCA, NP, SP, HP
ignorehitpause = 1

[State 0, AngleDraw]
type = AngleDraw
trigger1 = time<240
value = 0
scale = 0.5,0.5
ignorehitpause = 1
;persistent =

[State 0, AngleDraw]
type = AngleDraw
trigger1 = time>=240
value = 0
scale = 0.5-((time-240)/20.0),0.5-((time-240)/20.0)
ignorehitpause = 1
;persistent =

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = p2dist x=[-50,50]
movetype = A        ;I,A,H
ignorehitpause = 1
;persistent =

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = p2dist x!=[-50,50]
movetype = I        ;I,A,H
ignorehitpause = 1
;persistent =


[State 200, 1]
type = HitDef
trigger1 = 1
attr = S, SP
damage = 0, 0
animtype = Light
;guardflag = MA
hitflag = MAFD
priority = 4, Hit
pausetime = 0,0
guard.pausetime = 0,0
sparkno = -1 ;s7010+10*(random%3)  ;s7030
guard.sparkno = -1 ;s7000
sparkxy = -17,-60
hitsound = -1 ;s5, random%3
guardsound = -1 ;S6,1
ground.type = Low
ground.slidetime = 0
ground.hittime  = 0
ground.velocity = 0
ground.cornerpush.veloff = 0
guard.velocity = 0
airguard.velocity = 0,0
air.type = High
air.velocity = 0,0
air.hittime = 0
air.animtype = back
getpower= 0,0 ;ifelse(p2movetype=H,20,140), 5
givepower = 0,0 ;8,8
yaccel = 0.5
persistent = 0

[State 3010, Helper]
type = Helper
triggerall = !NumHelper(2950)
trigger1 = movecontact
trigger1 = var(1):=IfElse((target,vel X<0),90*(target,facing)+floor(target,screenpos X)-40*(target,facing)*(target,statetype=A),-90*(target,facing)+floor(target,screenpos X)-40*(target,facing)*(target,statetype=A))
trigger1 = var(2):=-220+floor(target,screenpos Y)+target,Const(size.mid.pos.y)
helpertype = normal
name = "Floating Bomb"
ID =   2950
stateno = 2950
pos = var(1),var(2) ;Winmugen fix for long strings... way to go Elecbyte!!!
postype = left   ;p2,front,back,left,right
facing = target,facing ;1
keyctrl = 0
ownpal = 1
;size.shadowoffset = 0
supermovetime = 0
pausemovetime = 0


[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = Time=240
movetype = I        ;I,A,H
ignorehitpause = 1
;persistent =

[State 0, ChangeState]
type = ChangeState
trigger1= movecontact ;moveguarded
value = 2955
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

[State 0, DestroySelf]
type = DestroySelf
trigger1 = time = 250
trigger2 = enemy,stateno=[6920,6927] ; remove when Curse Lv.3
ignorehitpause = 1
;persistent =
;======================================================================

;Top Hat Helper
[Statedef 3186]
type = S
ctrl = 0
anim = 3186
velset = 0,0
sprpriority = 10

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow


[State 182, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

[State 190, 1] ;Freeze animation until PreIntro is over
type = ChangeAnim
trigger1 = Pos Y > root,var(52)
value = 3186


[State 0, PosAdd]
type = PosAdd
triggerall = Pos Y > root,var(52)
trigger1 = time>100
y = -1
;ignorehitpause =
;persistent =

[State 0, PosSet]
type = PosSet
trigger1 = Pos Y <= root,var(52)
y = root,var(52)
;ignorehitpause =
;persistent =

[State 0, DestroySelf]
type = DestroySelf
trigger1 = !animtime
;ignorehitpause =
;persistent =


; SHIELD FX

[Statedef 6120]
type = A
movetype = I
physics = N
ctrl = 0
anim = 6120
velset = 0,0
sprpriority = -10

[State 905, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = NoShadow


[State 0, BindToRoot]
type = BindToRoot
trigger1 = 1
time = 1
pos = -2,-33
ignorehitpause = 1
;persistent =

[State 0, Explod]
type = Explod
trigger1 = !time
anim = 6120
ID = 6120
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = -1
vel = 0,0
accel = 0,0
random = 0,0
removetime = -1
pausemovetime = 0
scale = 1,1
sprpriority = 1
ontop = 0
shadow = 0,0,0
ownpal = 0
removeongethit = 0
ignorehitpause = 1
trans = addalpha
alpha = 128,128 ;200,128 ;64,128
;persistent =
;supermove = 0
;pausemove = 0

[State 0, spark]
type = Explod
triggerall = !NumExplod(6121)
trigger1 = enemy,movecontact=1
anim = 6121
ID = 6121
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = -1
vel = 0,0
accel = 0,0
random = 0,0
removetime = -2
pausemovetime = 0
scale = 1,1
sprpriority = 1
ontop = 0
shadow = 0,0,0
ownpal = 1
removeongethit = 0
ignorehitpause = 1
;trans = addalpha
;alpha = 128,128 ;200,128 ;64,128
;persistent = 0
;supermove = 0
;pausemove = 0

[State 0, Enegy FX]
type = PalFX
triggerall = gametime%4=0
trigger1 = enemy,movecontact=1
time = 2
add = 100,100,100
mul = 256,256,256
sinadd = -80,-80,-80,10
invertall = 0
color = 256
ignorehitpause = 1
;persistent = 0

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = Root,stateno != [120,155]
id = 6120
ignorehitpause = 1
;persistent =


[State 905, DestroySelf]
type = DestroySelf
trigger1 = Root,stateno != [120,155]


; FOCUS SHIELD FX
[Statedef 6130]
type = A
movetype = I
physics = N
ctrl = 0
anim = 6130
velset = 0,0
sprpriority = -10

[State 905, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = NoShadow

[State 0, PalFX]
type = PalFX
trigger1 = !time
time = 100
add = 100,0,100
mul = 120,20,124
sinadd = 85,110,55,30
invertall = 0
color = 256
;ignorehitpause = 0
;persistent = 1


[State 0, BindToRoot]
type = BindToRoot
trigger1 = 1
time = 1
pos = -2,-33
ignorehitpause = 1
;persistent =

[State 0, Explod]
type = Explod
trigger1 = !time
anim = 6130
ID = 6130
pos = 0,0
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = -1
vel = 0,0
accel = 0,0
random = 0,0
removetime = -1
pausemovetime = 0
scale = 1,1
sprpriority = 1
ontop = 0
shadow = 0,0,0
ownpal = 0
removeongethit = 0
ignorehitpause = 1
trans = addalpha
alpha = 128,128 ;200,128 ;64,128
;persistent =
;supermove = 0
;pausemove = 0

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = Root,stateno != [1300,1302)
id = 6130
ignorehitpause = 1
;persistent =


[State 905, DestroySelf]
type = DestroySelf
trigger1 = Root,stateno != [1300,1302)

;Gravity Trap idle
[Statedef 6200]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 10

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6200

[State 0, PlaySnd]
type = PlaySnd
trigger1 = !time
value = 6200,0
volume = 200
channel = -1

[State 0, ChangeState]
type = ChangeState
triggerall = enemynear,statetype!=A
trigger1 = Screenpos X - (enemy,screenpos X) = [-40,40]
value = 6210
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

[State 0, DestroySelf]
type = DestroySelf
trigger1 = time = 180
trigger2 = enemy,stateno=[6920,6927] ; remove when Curse Lv.3
ignorehitpause = 1
;persistent =


;Gravity Trap Explosion
[Statedef 6210]
type = A
movetype = A
physics = N
ctrl = 0
sprpriority = 10

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6210

[State 0, PlaySnd]
type = PlaySnd
trigger1 = !time
value = 6200,1
volume = 200
channel = -1

[State 420, 3]
type = HitDef
trigger1 = AnimElem = 2
attr = S, SA
damage = 38,0
hitflag = MA
guardflag = MA
priority = 4, Hit
pausetime = 0,5
guard.pausetime = 0,5
sparkno = -1 ;s7030
guard.sparkno = -1 ;s7000
sparkxy = 0,0 ;-20,-65
hitsound   = s5, 2
guardsound = S6,1
animtype = Up
ground.type = High
ground.slidetime = 12
ground.hittime = 12
ground.velocity = -1,-14
guard.velocity = -9
air.velocity = ifelse(p2movetype=H,-3,-1),ifelse(p2movetype=H,-5,-10)
fall=1
air.fall = 1
fall.recover = 0
fall.recovertime = 30
air.animtype = back
getpower= ifelse(p2movetype=H,40,210), 35
givepower = 35,35
yaccel = 0.45



[State 890, 2]
type = Explod
triggerall = !NumExplod(8051)
trigger1 = AnimElemTime(5)=0
Anim = 8051
postype = P2
pos = 0,-20
bindtime = 15
sprpriority = 2
ownpal = 1
removetime = -2
removeongethit = 1

[State 10231, Superjump Sound]
type = playsnd
trigger1 = AnimElemTime(5)=0
value = 0,24
persistent = 0

[State 0, Combo keeper]
type = ChangeState
trigger1 = !animtime
value = 11111
ctrl = 0
ignorehitpause = 1
;persistent =

[State 0, DestroySelf]
type = DestroySelf
trigger1 = !animtime
;ignorehitpause =
;persistent =

;Cursed Skull
[Statedef 6501]
type = S
movetype = I
physics = N
velset = 0,0
sprpriority = 5
anim = 6501
ctrl = 0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = time<50 ;ugly hack
trigger2 = NumHelper(1500)=1
trigger2 = Helper(1500),stateno!=1501
flag = invisible
ignorehitpause = 1

[State 0, BindToParent]
type = BindToParent
trigger1 =  1
time = 1
facing = 0
pos = 0,-100
ignorehitpause = 1
;persistent =


[State 0, Turn]
type = Turn
trigger1 = facing!=enemyNear,facing
ignorehitpause = 1
;persistent =

[State 9990, DestroySelf]
type = DestroySelf
trigger1 = !NumHelper(1500)


;Crystal Ball Template
[Statedef 6800]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 10

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 0, Green Poison]
type = null ;PalFX
trigger1 = !time
time = -1
add = 0,100,50
mul = 20,120,24
sinadd = 85,110,55,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 0, Orange Wind]
type = null ;PalFX
trigger1 = !time
time = -1
add = 40,-70,-200
mul = 256,256,256
sinadd = 40,30,0,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 0, Gray Stone]
type = null;PalFX
trigger1 = !time
time = -1
add = 50,50,50
mul = 128,128,128
sinadd = 0,0,0,1
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 0, Red Fire]
type = null ;PalFX
trigger1 = !time
time = -1
add = 0,-200,-200
mul = 256,256,256
sinadd = 40,80,40,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 0, Yellow Lightning]
type = null ;PalFX
trigger1 = !time
time = -1
add = 40,40,-200
mul = 256,256,256
sinadd = 40,30,0,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 0, Blue Ice]
type = null ;PalFX
trigger1 = !time
time = -1
add = 0,50,240
mul = 120,224,150
sinadd = 85,55,110,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6800

[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3410, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3410, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 6810
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 0, VelSet]
type = VelSet
trigger1 = !time
x = 3
;ignorehitpause =
;persistent =

[State 0, VelSet]
type = VelSet
trigger1 = ((Screenpos X)-(root,Screenpos X))>60
x = -3
;ignorehitpause =
;persistent =

[State 0, DestroySelf]
type = DestroySelf
trigger1 = (vel X<0) && (rootdist X >=0)
;trigger2 = time = 180
;ignorehitpause =
;persistent =

;s.LP Ball - Poison
[Statedef 6801]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = -10
hitcountpersist = 1
movehitpersist = 1

[State 6815, AfterImage Helper]
type = Helper
trigger1 = !time
helpertype = normal
name = "CB After Image"
ID =   6815
stateno = 6815
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
;size.shadowoffset = 0
supermovetime = 0
pausemovetime = 0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 0, Green Poison]
type = PalFX
trigger1 = !time
time = -1
add = 0,100,50
mul = 20,120,24
sinadd = 85,110,55,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1



[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6800


[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3410, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3410, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 6810
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 200, crystal woosh]
type = PlaySnd
trigger1 = time=4
value = 6800, 10
channel = 1

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = time=4
movetype = A

[State 200, 1]
type = HitDef
trigger1 = 1
attr = S, NA
damage = 23, 0
animtype = light
guardflag = MA
hitflag = MAF
priority = 2, Hit
pausetime = 0,10
guard.pausetime = 0,10
sparkno = s7010
guard.sparkno = s7000
sparkxy = 0,0
hitsound = s6800, 0
guardsound = S6,0
ground.type = High
ground.slidetime = 7
ground.hittime  = 7
ground.velocity = -2.5 ;-3
ground.cornerpush.veloff = 0
guard.velocity = -4.5
airguard.velocity = -1.9,-.8
air.velocity = -2,-2
air.hittime = 12
air.animtype = back
getpower= 40,35
givepower = 35,35
yaccel = 0.5
ID = 1098
palfx.time = 10
palfx.mul = 20,120,24
palfx.add = 0,100,50
palfx.sinadd = 85,110,55,10
persistent = 0

[State 0, VelSet]
type=velset
trigger1=1
x=4*sin(time*0.15)
ignorehitpause=1
persistent=1

[State 0, Vanish if Babidi is hit]
type = ChangeState
trigger1 =  root,movetype=H
trigger2 = time>60 ;safevalue
value = 6810
ctrl = 0

[State 0, DestroySelf]
type = DestroySelf
trigger1 = (movetype=A) && (rootdist X>=0)
trigger2 = time>70 ;safevalue
;ignorehitpause =
;persistent =

;s.MP Ball  - Wind
[Statedef 6802]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = -10
hitcountpersist = 1
movehitpersist = 1

[State 6815, AfterImage Helper]
type = Helper
trigger1 = !time
helpertype = normal
name = "CB After Image"
ID =   6815
stateno = 6815
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
;size.shadowoffset = 0
supermovetime = 0
pausemovetime = 0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 0, Orange Wind]
type = PalFX
trigger1 = !time
time = -1
add = 40,-70,-200
mul = 256,256,256
sinadd = 40,30,0,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1


[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6800


[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3410, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3410, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 6810
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 200, crystal woosh]
type = PlaySnd
trigger1 = time=4
value = 6800, 11
channel = 1

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = time=7
movetype = A

[State 200, 1]
type = HitDef
trigger1 = 1
attr = S, NA
damage = 32, 0
animtype = Medium
guardflag = MA
hitflag = MAF
priority = 3, Hit
pausetime = 0,11
guard.pausetime = 0,11
sparkno = -1 ;s7020
guard.sparkno = -1 ;s7000
sparkxy = -12,-55
hitsound = s6800, 1
guardsound = S6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = -8 ;-2.5
ground.cornerpush.veloff = 0
guard.velocity = -6
airguard.velocity = -2,-1.1
air.type = High
air.velocity = -3,-3
air.hittime = 12
air.animtype = back
getpower= ifelse(p2movetype=H,40,140), 35
givepower = 35,35
yaccel = 0.5
ID = 1098
palfx.time = 11
palfx.mul = 256,256,256
palfx.add = 40,-70,-200
palfx.sinadd = 40,30,0,10
persistent = 0

[State 3020, Sparks]
type=explod
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim=6802
sprpriority=7
postype=p2
pos= -10, 0 ;(target,const(size.ground.front)-2),0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 3020, Guard Sparks]
type=explod
trigger1= moveguarded
anim=6802
sprpriority=7
postype=p2
pos= -10, 0 ;(target,const(size.ground.front)-2), 0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 200, tornado]
type = PlaySnd
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
value = 7,1
volume = 300
persistent = 0


[State 0, VelSet]
type=velset
trigger1=1
x=4*sin(time*0.12)
y=-1*cos(time*0.12)
ignorehitpause=1
persistent=1

[State 0, Vanish if Babidi is hit]
type = ChangeState
trigger1 =  root,movetype=H
trigger2 = time>60 ;safevalue
value = 6810
ctrl = 0

[State 0, DestroySelf]
type = DestroySelf
trigger1 = (movetype=A) && (rootdist X>=0)
trigger2 = time>70 ;safevalue
;ignorehitpause =
;persistent =

;s.SP Ball - Stone
[Statedef 6803]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = -10
hitcountpersist = 1
movehitpersist = 1

[State 6815, AfterImage Helper]
type = Helper
trigger1 = !time
helpertype = normal
name = "CB After Image"
ID =   6815
stateno = 6815
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
;size.shadowoffset = 0
supermovetime = 0
pausemovetime = 0


[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 0, Gray Stone]
type = PalFX
trigger1 = !time
time = -1
add = 50,50,50
mul = 128,128,128
sinadd = 0,0,0,1
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1


[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6800


[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3410, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3410, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 6810
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 200, crystal woosh]
type = PlaySnd
trigger1 = time=4
value = 6800, 12
channel = 1

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = time=9
movetype = A

[State 200, 1]
type = HitDef
trigger1 = 1
attr = S, NA
damage = 45, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 0,20 ;13
guard.pausetime = 0,13
sparkno = -1 ;s7030
guard.sparkno = -1 ;s7000
sparkxy = -20,-75
hitsound = s6800, 2
guardsound = S6,1
ground.type = High
ground.slidetime = 0 ;15
ground.hittime  = 18
ground.velocity = -7
ground.cornerpush.veloff = 0
guard.velocity = -9
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -4,4
air.hittime = 12
air.animtype = back
getpower= ifelse(p2movetype=H,40,210), 35
givepower = 35,35
yaccel = 0.5
ID = 1098
palfx.time = 13
palfx.mul = 128,128,128
palfx.add = 50,50,50
palfx.sinadd = 0,0,0,1
palfx.color = 0
persistent = 0


[State 3020, Sparks]
type=null;explod
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim=17100
sprpriority=-7
postype=p2
pos= 0, 0 ;(target,const(size.ground.front)-2),0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 3010, Debris Generator]
type = Helper
triggerall = !Numhelper(66853)
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
helpertype = normal
name = "Debris Generator"
ID =   66853
stateno = 66853
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
;size.shadowoffset = 0
supermovetime = 0
pausemovetime = 0

[State 3020, Guard Sparks]
type=explod
trigger1= moveguarded
anim=17100
sprpriority=-7
postype=p2
pos= 0, 0 ;(target,const(size.ground.front)-2), 0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100


[State 0, VelSet]
type=velset
trigger1=1
x=4.3*sin(time*0.11)
y=4.3*cos(time*0.11)
ignorehitpause=1
persistent=1

[State 0, Vanish if Babidi is hit]
type = ChangeState
trigger1 =  root,movetype=H
trigger2 = time>60 ;safevalue
value = 6810
ctrl = 0

[State 0, DestroySelf]
type = DestroySelf
trigger1 = (movetype=A) && (rootdist X>=0)
trigger2 = time>70 ;safevalue
;ignorehitpause =
;persistent =

;s.LK Ball - Fire
[Statedef 6804]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = -10
hitcountpersist = 1
movehitpersist = 1

[State 6815, AfterImage Helper]
type = Helper
trigger1 = !time
helpertype = normal
name = "CB After Image"
ID =   6815
stateno = 6815
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
;size.shadowoffset = 0
supermovetime = 0
pausemovetime = 0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 0, Red Fire]
type = PalFX
trigger1 = !time
time = -1
add = 0,-200,-200
mul = 256,256,256
sinadd = 40,80,40,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6800


[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3410, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3410, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 6810
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 200, crystal woosh]
type = PlaySnd
trigger1 = time=4
value = 6800, 10
channel = 1

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = time=4
movetype = A

[State 230, 2]
type = HitDef
trigger1 = 1
attr = S, NA
animtype  = Light
damage    = 26,0
priority = 2, Hit
guardflag = MA
pausetime = 0,10
guard.pausetime = 0,10
sparkno = -1 ;s7010
guard.sparkno = -1 ;s7000
sparkxy = -10,-30
hitsound = s6800, 0
guardsound = S6,0
ground.type = Low
ground.slidetime = 8
ground.hittime  = 8
ground.velocity = -2.5
ground.cornerpush.veloff = 0
guard.velocity = -4.5
air.velocity = -2,-3
air.animtype = back
getpower= 40,35
givepower = 35,35
yaccel = 0.5
ID = 1098
palfx.time = 10
palfx.mul = 256,256,256
palfx.add = 0,-200,-200
palfx.sinadd = 40,80,40,10
persistent = 0

[State 9990, Explod]
type = Explod
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim = 8600
ID = 8600
pos = 5,-45  ;(enemynear,const(size.mid.pos.x))-20,(enemynear,const(size.mid.pos.y))-10
postype = p2
removetime = -2 ;120
sprpriority = 3
bindtime = -1
ownpal = 1
facing = IfElse(random<500,1,-1) ;-1
persistent = 0

[State 9990, Explod]
type = Explod
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim = 8601
ID = 8601
pos = 15,-10   ;(enemynear,const(size.mid.pos.x))-40,(enemynear,const(size.mid.pos.y))+10
postype = p2
removetime = -2 ;120
sprpriority = 3
bindtime = -1
ownpal = 1
facing = IfElse(random<500,1,-1) ;-1
persistent = 0

[State 9990, Explod]
type = Explod
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim = 8601
ID = 8602
pos = -15,-20   ;(enemynear,const(size.mid.pos.x))+10,(enemynear,const(size.mid.pos.y))-30
postype = p2
removetime = -2 ;120
sprpriority = 4
bindtime = -1
ownpal = 1
facing = IfElse(random<500,1,-1) ;-1
persistent = 0

[State 200, burn]
type = PlaySnd
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
value = 734,0
volume = 300
persistent = 0


[State 0, VelSet]
type=velset
trigger1=1
x=3*sin(time*0.15)
y=4*sin(time*0.15)
ignorehitpause=1
persistent=1

[State 0, Vanish if Babidi is hit]
type = ChangeState
trigger1 =  root,movetype=H
trigger2 = time>60 ;safevalue
value = 6810
ctrl = 0

[State 0, DestroySelf]
type = DestroySelf
trigger1 = (movetype=A) && (rootdist X>=0)
trigger2 = time>70 ;safevalue
;ignorehitpause =
;persistent =

;s.MK Ball - Lightning
[Statedef 6805]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = -10
hitcountpersist = 1
movehitpersist = 1

[State 6815, AfterImage Helper]
type = Helper
trigger1 = !time
helpertype = normal
name = "CB After Image"
ID =   6815
stateno = 6815
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
;size.shadowoffset = 0
supermovetime = 0
pausemovetime = 0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 0, Yellow Lightning]
type = PalFX
trigger1 = !time
time = -1
add = 40,40,-200
mul = 256,256,256
sinadd = 40,30,0,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6800


[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3410, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3410, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 6810
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 200, crystal woosh]
type = PlaySnd
trigger1 = time=4
value = 6800, 11
channel = 1

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = time=7
movetype = A

[State 240, 2]
type = HitDef
trigger1 = 1
attr = S, NA
animtype = Medium
damage = 37,0
guardflag = MA
hitflag = MAF
priority = 3, Hit
pausetime = 0, 11
guard.pausetime = 0,11
sparkno = -1 ;s7020
guard.sparkno = -1 ;s7000
sparkxy = -20,-75
hitsound = s6800, 1
guardsound = S6,0
ground.type = High
ground.slidetime = 12;8
ground.hittime  = 12;8
ground.velocity = -2
ground.cornerpush.veloff = 0
guard.velocity = -6
air.velocity = -3,-3
airguard.velocity = -2,-1.1
air.animtype = back
getpower= ifelse(p2movetype=H,40,140), 35
givepower = 35,35
yaccel = 0.5
ID = 1098
palfx.time = 11
palfx.mul = 256,256,256
palfx.add = 40,40,-200
palfx.sinadd = 40,30,0,10
persistent = 0


[State 3020, Sparks]
type=explod
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim=2430
sprpriority=7
postype=p2
pos= -10, -40 ;(target,const(size.ground.front)-2),0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 3020, Guard Sparks]
type=explod
trigger1= moveguarded
anim=2430
sprpriority=7
postype=p2
pos= -10, -40 ;(target,const(size.ground.front)-2), 0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 200, shocked]
type = PlaySnd
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
value = 2400,2
volume = 300
persistent = 0


[State 0, VelSet]
type=velset
trigger1=1
x=4*sin(time*0.11)
y=3*cos(time*0.15)
ignorehitpause=1
persistent=1

[State 0, Vanish if Babidi is hit]
type = ChangeState
trigger1 =  root,movetype=H
trigger2 = time>60 ;safevalue
value = 6810
ctrl = 0

[State 0, DestroySelf]
type = DestroySelf
trigger1 = (movetype=A) && (rootdist X>=0)
trigger2 = time>70 ;safevalue
;ignorehitpause =
;persistent =

;s.SK Ball - Ice
[Statedef 6806]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = -10
hitcountpersist = 1
movehitpersist = 1

[State 6815, AfterImage Helper]
type = Helper
trigger1 = !time
helpertype = normal
name = "CB After Image"
ID =   6815
stateno = 6815
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
;size.shadowoffset = 0
supermovetime = 0
pausemovetime = 0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 0, Blue Ice]
type = PalFX
trigger1 = !time
time = -1
add = 0,50,240
mul = 120,224,150
sinadd = 85,55,110,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6800


[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3410, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3410, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 6810
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 200, crystal woosh]
type = PlaySnd
trigger1 = time=4
value = 6800, 12
channel = 1

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = time=9
movetype = A

[State 250, hit]
type = HitDef
trigger1 = 1
attr = S, NA
animtype  = Hard
damage    = 48,0
priority = 4, Hit
guardflag = MA
pausetime = 0,20 ;13
guard.pausetime = 0,13
sparkno = -1 ;s7030
guard.sparkno = -1 ;s7000
sparkxy = 0,0 ;-20,-85
hitsound = s6800, 2
guardsound = S6,1
ground.type = high
ground.slidetime = 15
ground.hittime = 18 ;15
ground.velocity = 0 ;-9
ground.cornerpush.veloff = 0
air.velocity = -4,-2
air.animtype = back
getpower= ifelse(p2movetype=H,40,210), 35
givepower = 35,35
yaccel = 0.5
fall = 0
palfx.time = 13
palfx.mul = 120,224,150
palfx.add = 0,50,240
;palfx.sinadd = 85,55,110,10
palfx.sinadd = 0,0,0,1
palfx.color = 0
persistent = 0

[State 3020, Sparks]
type=explod
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim=6806
sprpriority=7
postype=p2
pos= 0,-20 ;-10, -40 ;(target,const(size.ground.front)-2),0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 3020, Guard Sparks]
type=explod
trigger1= moveguarded
anim=6806
sprpriority=7
postype=p2
pos= 0,-20 ;-10, -40 ;(target,const(size.ground.front)-2), 0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 200, shocked]
type = null ;PlaySnd
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
value = 2400,2
volume = 300
persistent = 0


[State 0, VelSet]
type=velset
trigger1=1
x=3*sin(time*0.11)
y=5*cos(time*0.09)
ignorehitpause=1
persistent=1

[State 0, Vanish if Babidi is hit]
type = ChangeState
trigger1 = root,movetype=H
trigger2 = time>60 ;safevalue
value = 6810
ctrl = 0

[State 0, DestroySelf]
type = DestroySelf
trigger1 = (movetype=A) && (rootdist X>=0)
trigger2 = time>70 ;safevalue
;ignorehitpause =
;persistent =


;Crystal Ball Vanish
[Statedef 6810]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 10

[State 0, AngleDraw]
type = AngleDraw
trigger1 = !time
value = 0
;scale =
;ignorehitpause =
;persistent =

[State 0, VelSet]
type = VelSet
trigger1 = !time
x = 0
y = 0

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
;value2 = S,NA
time = 1
;ignorehitpause =
;persistent =


[state 0, remove afterimage]
type = afterimagetime
trigger1 = !time
time = 0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6810

[State 10231, Rock Broken]
type = playsnd
triggerall = prevstateno=6853
trigger1 = !time
value = 6853,1

[State 10231, Broken]
type = playsnd
triggerall = prevstateno!=6853
trigger1 = !time
value = 20000,0

[State 0, DestroySelf]
type = DestroySelf
trigger1 = !animtime
;ignorehitpause =
;persistent =

;CB AfterImage Helper
[Statedef 6815]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = -10

[State 0, BindToParent]
type = BindToParent
trigger1 = !time
time = 100
facing = 0
pos = 0,0
ignorehitpause = 1
persistent = 0

[State 0, BindToParent]
type = BindToParent
triggerall = NumHelper(6800)=1
trigger1 = Helper(6800),stateno=6810 ;!NumHelper(6800)
time = 0
facing = 0
pos = 0,0
ignorehitpause = 1
persistent =0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
flag2 = invisible
ignorehitpause = 1
;persistent =

[State 0, Green Poison]
type = PalFX
triggerall = !time
triggerall = NumHelper(6800)=1
trigger1 = Helper(6800),stateno=6801
time = -1
add = 0,100,50
mul = 20,120,24
sinadd = 85,110,55,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 0, AfterImageGreen Poison]
type = AfterImage
triggerall = !time
triggerall = NumHelper(6800)=1
trigger1 = Helper(6800),stateno=6801
time = -1
palcolor = 256
palinvertall = 0
palbright = 30,30,30
palcontrast = 120,120,220
palpostbright = 0,0,0
paladd = 0,100,50
timegap = 3
framegap = 3

[State 0, Orange Wind]
type = PalFX
triggerall = !time
triggerall = NumHelper(6800)=1
trigger1 = Helper(6800),stateno=6802
time = -1
add = 40,-70,-200
mul = 256,256,256
sinadd = 40,30,0,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 0, AfterImage Orange Wind]
type = AfterImage
triggerall = !time
triggerall = NumHelper(6800)=1
trigger1 = Helper(6800),stateno=6802
time = -1
palcolor = 256
palinvertall = 0
palbright = 30,30,30
palcontrast = 120,120,220
palpostbright = 0,0,0
paladd = 40,-70,-200
timegap = 3
framegap = 3

[State 0, Gray Stone]
type = PalFX
triggerall = !time
triggerall = NumHelper(6800)=1
trigger1 = Helper(6800),stateno=6803
time = -1
add = 50,50,50
mul = 128,128,128
sinadd = 0,0,0,1
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 0, AfterImage Gray Stone]
type = AfterImage
triggerall = !time
triggerall = NumHelper(6800)=1
trigger1 = Helper(6800),stateno=6803
time = -1
palcolor = 0
palinvertall = 0
palbright = 30,30,30
palcontrast = 120,120,220
palpostbright = 0,0,0
paladd = 50,50,50
timegap = 3
framegap = 3

[State 0, Red Fire]
type = PalFX
triggerall = !time
triggerall = NumHelper(6800)=1
trigger1 = Helper(6800),stateno=6804
time = -1
add = 0,-200,-200
mul = 256,256,256
sinadd = 40,80,40,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 0, AfterImage Red Fire]
type = AfterImage
triggerall = !time
triggerall = NumHelper(6800)=1
trigger1 = Helper(6800),stateno=6804
time = -1
palcolor = 256
palinvertall = 0
palbright = 30,30,30
palcontrast = 120,120,220
palpostbright = 0,0,0
paladd = 0,-200,-200
timegap = 3
framegap = 3

[State 0, Yellow Lightning]
type = PalFX
triggerall = !time
triggerall = NumHelper(6800)=1
trigger1 = Helper(6800),stateno=6805
time = -1
add = 40,40,-200
mul = 256,256,256
sinadd = 40,30,0,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1


[State 0, AfterImage Yellow Lightning]
type = AfterImage
triggerall = !time
triggerall = NumHelper(6800)=1
trigger1 = Helper(6800),stateno=6805
time = -1
palcolor = 256
palinvertall = 0
palbright = 30,30,30
palcontrast = 120,120,220
palpostbright = 0,0,0
paladd = 40,40,-200
timegap = 3
framegap = 3

[State 0, Blue Ice]
type = PalFX
triggerall = !time
triggerall = NumHelper(6800)=1
trigger1 = Helper(6800),stateno=6806
time = -1
add = 0,50,240
mul = 120,224,150
sinadd = 85,55,110,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1


[State 0, AfterImage Blue Ice]
type = AfterImage
triggerall = !time
triggerall = NumHelper(6800)=1
trigger1 = Helper(6800),stateno=6806
time = -1
palcolor = 256
palinvertall = 0
palbright = 30,30,30
palcontrast = 120,120,220
palpostbright = 0,0,0
paladd = 0,50,240
timegap = 3
framegap = 3

[state -3, remove afterimage]
type = afterimagetime
trigger1 = !NumHelper(6800)
trigger2 = root,movetype=H
time = 0


[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6800

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
;value2 = S,NA
time = 1
;ignorehitpause =
;persistent =

[State 0, DestroySelf]
type = DestroySelf
trigger1 = time>100 ;90 ;safevalue
;ignorehitpause =
;persistent =


;Ball - Launcher
[Statedef 6851]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 10

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =


[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6700


[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3410, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3410, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 6810 ;6875
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 200, crystal woosh]
type = PlaySnd
trigger1 = time=2
value = 3500,0
channel = 1

[State 0, VelSet]
type=velset
trigger1=!time
x = 2
y = -2
ignorehitpause=1

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElemTime(2)=0
movetype = A

[State 200, 1]
type = HitDef
trigger1 = 1
attr = S, NA
damage = 38, 0
animtype = Back
hitflag = MAF
guardflag = MA
priority = 4, Hit
pausetime = 0,15
guard.pausetime = 15,15
sparkno = -1 ;s7030
guard.sparkno = -1 ;s7000
sparkxy = -20,-75
hitsound   = s5, 2
guardsound = S6,1
animtype = Up
ground.type = High
ground.slidetime = 12
ground.hittime = 12
ground.velocity = -3,-8 ;-11.5
ground.cornerpush.veloff = 0
guard.velocity = -9
air.velocity = ifelse(p2movetype=H,-3,-1),ifelse(p2movetype=H,-5,-10)
fall = 1
air.animtype = back
getpower= 40, 35
givepower = 35,35
yaccel = 0.45
ID = 1098
palfx.time = 15
palfx.mul = 20,120,24
palfx.add = 0,100,50
palfx.sinadd = 85,110,55,10
persistent = 0


[State 3020, Sparks]
type=explod
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim=17100
sprpriority=-7
postype=p2
pos= 0, 0 ;(target,const(size.ground.front)-2),0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 3020, Guard Sparks]
type=explod
trigger1= moveguarded
anim=17100
sprpriority=-7
postype=p2
pos= 0, 0 ;(target,const(size.ground.front)-2), 0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100


[State 0, Vanish if Babidi is hit]
type = null ;ChangeState
trigger1 =  root,movetype=H
;trigger2 = movecontact
value = 6810
ctrl = 0

[State 0, Combo keeper]
type = ChangeState
trigger1 = !animtime
value = 11111
ctrl = 0
ignorehitpause = 1
;persistent =

[State 0, DestroySelf]
type = DestroySelf
trigger1 = !animtime
;ignorehitpause =
;persistent =

;Ball - Tornado
[Statedef 6852]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 10

[State 0, HP]
type = VarAdd
trigger1 = !time
var(1) = 1
;ignorehitpause =
;persistent =

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =


[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6852


[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3410, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3410, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 6852
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 200, Tornado sound]
type = PlaySnd
trigger1 = time=2
value = 100,2
channel = 7
lowpriority = 1

[State 0, VelSet]
type=velset
trigger1=!time
x = 1
ignorehitpause=1

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElemTime(2)=0
movetype = A

[State 200, 1]
type = HitDef
trigger1 = 1
attr = S, NA
damage = 18, 0
animtype = Medium
guardflag = MA
hitflag = MAF
priority = 7, Hit
pausetime = 11,11
guard.pausetime = 11,11
sparkno = -1 ;s7020
guard.sparkno = -1 ;s7000
sparkxy = -12,-55
hitsound = s6800, 1
guardsound = S6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 12
ground.velocity = -8 ;-2.5
ground.cornerpush.veloff = 0
guard.velocity = -6
airguard.velocity = -2,-1.1
air.type = High
air.velocity = -3,-3
air.hittime = 12
air.animtype = back
getpower= ifelse(p2movetype=H,40,140), 35
givepower = 35,35
yaccel = 0.5
ID = 1098
palfx.time = 11
palfx.mul = 256,256,256
palfx.add = 40,-70,-200
palfx.sinadd = 40,30,0,10
persistent = 0


[State 3020, Sparks]
type=explod
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim=17100
sprpriority=-7
postype=p2
pos= 0, 0 ;(target,const(size.ground.front)-2),0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 3020, Guard Sparks]
type=explod
trigger1= moveguarded
anim=17100
sprpriority=-7
postype=p2
pos= 0, 0 ;(target,const(size.ground.front)-2), 0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100


[State 0, Vanish if Babidi is hit]
type = ChangeState
;trigger1 =  root,movetype=H
trigger1 = movecontact
value = 6852
ctrl = 0

[State 0, ChangeState]
type = ChangeState
trigger1 = time = 60 ;!animtime
trigger2 = var(1)>=4
value = 66852
ctrl = 0

[State 0, DestroySelf]
type = null;DestroySelf
trigger1 = time = 80
;ignorehitpause =
;persistent =

;Ball - Tornado Vanish
[Statedef 66852]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 10

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 66852


[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NA, SA, HA, NP, SP, HP, NT, ST, HT
ignorehitpause = 1

[State 0, Combo keeper]
type = ChangeState
trigger1 = !animtime
value = 11111
ctrl = 0
ignorehitpause = 1
;persistent =

[State 0, DestroySelf]
type = DestroySelf
trigger1 = !animtime
;ignorehitpause =
;persistent =

;Ball - Rockfall
[Statedef 6853]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = -10

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =


[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6853


[State 0, AngleDraw]
type = AngleDraw
trigger1 = 1
value = time*10
;scale =
;ignorehitpause =
;persistent =


[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3410, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3410, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 6810 ;6875
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 200, crystal woosh]
type = PlaySnd
trigger1 = time=2
value = 3500,0
channel = 1

[State 0, VelSet]
type=velset
trigger1=!time
y = 7
ignorehitpause=1

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = p2dist Y<160
movetype = A

[State 200, 1]
type = HitDef
trigger1 = 1
attr = S, NP
damage = 45, 0
animtype = Back
hitflag = MAFD
guardflag = HA
priority = 4, Hit
pausetime = 0,13 ;0,20 ;13
guard.pausetime = 13,13 ;0,13
sparkno = -1 ;s7030
guard.sparkno = -1 ;s7000
sparkxy = -20,-75
hitsound = s6800, 2
guardsound = S6,1
ground.type = Trip
ground.slidetime = 0 ;15
ground.hittime  = 18
ground.velocity = 0 ;-7
ground.cornerpush.veloff = 0
guard.velocity = 0 ;-9
fall = 1
air.fall = 1
airguard.velocity = 0,1.3 ;-2.5,-1.3
air.type = High
air.velocity = 0,2 ;-4,-4
air.hittime = 12
air.animtype = back
getpower= ifelse(p2movetype=H,40,210), 35
givepower = 35,35
yaccel = 0.5
ID = 1098
palfx.time = 13
palfx.mul = 128,128,128
palfx.add = 50,50,50
palfx.sinadd = 0,0,0,1
palfx.color = 0
persistent = 0

[State 3010, Debris Generator]
type = Helper
triggerall = !Numhelper(66853)
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
helpertype = normal
name = "Debris Generator"
ID =   66853
stateno = 66853
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
;size.shadowoffset = 0
supermovetime = 0
pausemovetime = 0


[State 3020, Sparks]
type=explod
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim=17100
sprpriority=-7
postype=p2
pos= 0, 0 ;(target,const(size.ground.front)-2),0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 3020, Guard Sparks]
type=explod
trigger1= moveguarded
anim=17100
sprpriority=-7
postype=p2
pos= 0, 0 ;(target,const(size.ground.front)-2), 0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 3020, touch ground Sparks]
type=explod
triggerall = !NumExplod(17100)
trigger1= pos Y >= 0
anim=17100
ID = 17100
sprpriority=-7
postype=p1
pos= -7, 0 ;(target,const(size.ground.front)-2), 0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100



[State 0, Vanish if Babidi is hit]
type = ChangeState
;trigger1 =  root,movetype=H
trigger1 = movecontact
trigger2 = pos Y >= 0
value = 6810
ctrl = 0

[State 0, DestroySelf]
type = DestroySelf
trigger1 = (pos y!=[-10000,240])
;trigger2 = pos Y >= 0
;ignorehitpause =
;persistent =

;Debris generator
[Statedef 66853]
type = A
movetype = I
physics = N
anim = 15999

[State 1003, Helper 1]
type = Helper
trigger1 = 1
helpertype = Normal
name = "Debris"
id = 66854
pos = 0,0
postype = p1
facing = facing
stateno = 66854
keyctrl = 0
ownpal = 1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
size.xscale = .125
size.yscale = .125

[State 1003, Helper 2]
type = Helper
trigger1 = 1
helpertype = Normal
name = "Debris"
id = 66854
pos = 0,0
postype = p1
facing = facing
stateno = 66854
keyctrl = 0
ownpal = 1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
size.xscale = .125
size.yscale = .125

[State 1003, Helper 3]
type = Helper
trigger1 = 1
helpertype = Normal
name = "Debris"
id = 66854
pos = 0,0
postype = p1
facing = facing
stateno = 66854
keyctrl = 0
ownpal = 1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
size.xscale = .125
size.yscale = .125

[State 1003, Helper 4]
type = Helper
trigger1 = 1
helpertype = Normal
name = "Debris"
id = 66854
pos = 0,0
postype = p1
facing = facing
stateno = 66854
keyctrl = 0
ownpal = 1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
size.xscale = .125
size.yscale = .125

[State 1003, DestroySelf]
type = DestroySelf
trigger1 = time=2

;Debris
[Statedef 66854]
type = A
movetype = I
physics = N
anim = 19890 + random%6
sprpriority = 7

[State 0, VelSet]
type = VelSet
trigger1 = !time
x = 6-random%12
y = -5+random%5
;ignorehitpause =
;persistent =

[State 0, Gravity]
type = Gravity
trigger1 = 1
;ignorehitpause =
;persistent =

[State 1004, assert]
type = assertspecial
trigger1 = 1
flag = noshadow

[State 1004, vel]
type = varset
trigger1 = !time
var(10) = random%2

[State 1004, assert]
type = angledraw
trigger1 = 1
value = ifelse(var(10)=0,5*time,-5*time)

[State 1004, DestroySelf]
type = DestroySelf
trigger1 = Pos y>=0

;Ball - Fireworks
[Statedef 6854]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 10

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6800

[State 0, AngleDraw]
type = AngleDraw
trigger1 = 1
value = 0
scale = 1-0.04*(time),1-0.04*(time)
;ignorehitpause =
;persistent =


[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3410, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3410, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 6864
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 200, Launch sound]
type = PlaySnd
trigger1 = time=2
value = 10,0
channel = -1

[State 0, VelSet]
type=velset
trigger1=!time
x = 4
y = -9
ignorehitpause=1

[State 0, Gravity]
type = Gravity
trigger1 = 1
;ignorehitpause =
;persistent =


[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElemTime(1)=0
movetype = A


[State 200, 1]
type = HitDef
trigger1 = 1
attr = S, SP
damage = 0, 0
animtype = Light
guardflag = MA
hitflag = MAFD
priority = 4, Hit
pausetime = 0,0
guard.pausetime = 0,0
sparkno = -1 ;s7010+10*(random%3)  ;s7030
guard.sparkno = -1 ;s7000
sparkxy = -17,-60
hitsound = -1 ;s5, random%3
guardsound = -1 ;S6,1
ground.type = Low
ground.slidetime = 0
ground.hittime  = 0
ground.velocity = 0
ground.cornerpush.veloff = 0
guard.velocity = 0
airguard.velocity = 0,0
air.type = High
air.velocity = 0,0
air.hittime = 0
air.animtype = back
getpower= 0,0
givepower = 0,0
yaccel = 0.5
persistent = 0
numhits = 0



[State 0, Vanish if Babidi is hit]
type = ChangeState
trigger1 = time=26
trigger2 = movecontact
value = 6864
ctrl = 0


[State 0, DestroySelf]
type = DestroySelf
trigger1 = time = 30
;ignorehitpause =
;persistent =

;Ball - Fireworks Vanish
[Statedef 6864]
type = A
movetype = A
physics = N
ctrl = 0
sprpriority = 10

[State 0, VelSet]
type = VelSet
trigger1 = !time
x = 0
y = 0
;ignorehitpause =
;persistent =

[State 200, BANG! sound]
type = PlaySnd
trigger1 = !time
value = 2302,2
channel = -1

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6864

[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NA, SA, HA, NP, SP, HP, NT, ST, HT
ignorehitpause = 1

[State 230, 2]
type = HitDef
trigger1 = time>0
attr = S, NA
animtype  = Light
damage    = 26,0
priority = 2, Hit
hitflag = MAFD
guardflag = MA
pausetime = 0,10
guard.pausetime = 0,10
sparkno = -1 ;s7010
guard.sparkno = -1 ;s7000
sparkxy = -10,-30
hitsound = s6800, 0
guardsound = S6,0
ground.type = Low
ground.slidetime = 8
ground.hittime  = 8
ground.velocity = -2.5
ground.cornerpush.veloff = 0
guard.velocity = -4.5
air.velocity = -2,-3
air.animtype = back
fall=1
air.fall = 1
fall.recover = 0
fall.recovertime = 30
getpower= 40,35
givepower = 35,35
yaccel = 0.5
ID = 1098
palfx.time = 10
palfx.mul = 256,256,256
palfx.add = 0,-200,-200
palfx.sinadd = 40,80,40,10
persistent = 0

[State 0, Combo keeper]
type = ChangeState
trigger1 = !animtime
value = 11111
ctrl = 0
ignorehitpause = 1
;persistent =

[State 0, DestroySelf]
type = DestroySelf
trigger1 = !animtime
;ignorehitpause =
;persistent =

;Ball - Lightning Strike
[Statedef 6855]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = -10

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 0, Yellow Lightning]
type = null;PalFX
trigger1 = !time
time = -1
add = 40,40,-200
mul = 256,256,256
sinadd = 40,30,0,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1


[State 0, AfterImage]
type = null ;AfterImage
trigger1 = !time
time = -1
palcolor = 256
palinvertall = 0
palbright = 30,30,30
palcontrast = 120,120,220
palpostbright = 0,0,0
paladd = 40,40,-200
timegap = 3
framegap = 3


[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6800


[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3410, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3410, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 6810 ;6875
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 200, crystal woosh]
type = PlaySnd
trigger1 = time=2
value = 3500,0
channel = 1



[State 0, VelSet]
type=velset
trigger1=!time
x = 3
ignorehitpause=1

[State 0, Vanish if Babidi is hit]
type = ChangeState
;trigger1 =  root,movetype=H
trigger1 = root,command!="hold_b" ;time>60 ;safevalue
trigger2 = p2dist x<60 && (root,var(59)>=1) && (random < 500*(root,var(53)/8.0))
value = 6875
ctrl = 0

[State 0, DestroySelf]
type = DestroySelf
trigger1 = (pos x!=[-240,240])
;ignorehitpause =
;persistent =

;Ball - Lightning Goes!
[Statedef 6875]
type = A
movetype = A
physics = N
ctrl = 0
velset = 0,0
sprpriority = -10

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =


[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6855


[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
;value2 = S,NA
time = 1
;ignorehitpause =
;persistent =

[State 200, rayden]
type = PlaySnd
trigger1 = !time
value = 2400,3
channel = 1


[State 240, 2]
type = HitDef
trigger1 = 1
attr = S, NA
animtype = Medium
damage = 37,0
guardflag = MA
hitflag = MAF
priority = 3, Hit
pausetime = 0, 11
guard.pausetime = 0,11
sparkno = -1 ;s7020
guard.sparkno = -1 ;s7000
sparkxy = -20,-75
hitsound = s6800, 1
guardsound = S6,0
ground.type = High
ground.slidetime = 12;8
ground.hittime  = 12;8
ground.velocity = -2,-5
ground.cornerpush.veloff = 0
guard.velocity = -6
fall=1
air.fall = 1
fall.recover = 0
fall.recovertime = 30
air.velocity = -3,-3
airguard.velocity = -2,-1.1
air.animtype = back
getpower= ifelse(p2movetype=H,40,140), 35
givepower = 35,35
yaccel = 0.5
ID = 1098
palfx.time = 11
palfx.mul = 256,256,256
palfx.add = 40,40,-200
palfx.sinadd = 40,30,0,10
persistent = 0


[State 3020, Sparks]
type=explod
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim=2430
sprpriority=7
postype=p2
pos= -10, -40 ;(target,const(size.ground.front)-2),0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 3020, Guard Sparks]
type=explod
trigger1= moveguarded
anim=2430
sprpriority=7
postype=p2
pos= -10, -40 ;(target,const(size.ground.front)-2), 0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 200, shocked]
type = PlaySnd
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
value = 2400,2
volume = 300
persistent = 0

[State 0, Combo keeper]
type = ChangeState
trigger1 = !animtime
value = 11111
ctrl = 0
ignorehitpause = 1
;persistent =


[State 0, DestroySelf]
type = DestroySelf
trigger1 = !animtime
;ignorehitpause =
;persistent =

;Ball - Freeze Shot
[Statedef 6856]
type = A
movetype = I
physics = N
ctrl = 0
sprpriority = 10


[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 0, ParentVarSet]  ;Enemy state tracker
type = ParentVarSet
trigger1 = 1
;trigger1 = enemynear,movetype!=H
;trigger2 = enemynear,stateno!=[5000,5999]
var(41) = enemynear,stateno
ignorehitpause = 1
;persistent =

[State 0, ParentVarSet]  ;Enemy Anim tracker
type = ParentVarSet
trigger1 = 1
;trigger1 = enemynear,movetype!=H
;trigger2 = enemynear,stateno!=[5000,5999]
var(42) = enemynear,Anim
ignorehitpause = 1
;persistent =

[State 0, ParentVarSet]  ;Enemy AnimElemNo tracker
type = ParentVarSet
trigger1 = 1
;trigger1 = enemynear,movetype!=H
;trigger2 = enemynear,stateno!=[5000,5999]
var(43) = enemynear,AnimElemno(0)
ignorehitpause = 1
;persistent =


[State 0, AfterImage]
type = null ;AfterImage
trigger1 = !time
time = -1
palcolor = 256
palinvertall = 0
palbright = 30,30,30
palcontrast = 120,120,220
palpostbright = 0,0,0
paladd = 0,50,240
timegap = 3
framegap = 3


[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6800

[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NA, SA, HA, NT, ST, HT
ignorehitpause = 1

[State 3410, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3410, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 6866
attr = SCA, NP, SP, HP
ignorehitpause = 1

[State 200, crystal woosh]
type = PlaySnd
trigger1 = time=4
value = 0, 2
channel = 1

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = time=9
movetype = A

[State 250, hit]
type = HitDef
trigger1 = 1
attr = S, NA ;SP
animtype  = Hard
damage    = 0,0
priority = 4, Hit
hitflag = MAFD
guardflag = MA
pausetime = 0,0 ;13
guard.pausetime = 0,0
sparkno = -1 ;s7030
guard.sparkno = -1 ;s7000
sparkxy = 0,0 ;-20,-85
hitsound = s6800, 2
guardsound = S6,1
ground.type = high
ground.slidetime = 15
ground.hittime = 18 ;15
ground.velocity = 0 ;-9
ground.cornerpush.veloff = 0
air.velocity = -4,-4
air.animtype = back
getpower= ifelse(p2movetype=H,40,210), 35
givepower = 35,35
yaccel = 0.5
fall = 0
;palfx.time = 13
;palfx.mul = 120,224,150
;palfx.add = 0,50,240
;palfx.sinadd = 85,55,110,10
;palfx.sinadd = 0,0,0,1
;palfx.color = 0
;p1stateno = 6866
;p2stateno = 6876
persistent = 0
ID = 6856

[State 0, Cursed flag detection]
type = ParentVarSet
trigger1 = !time
var(49) = 1
;ignorehitpause =
;persistent =

[State 0, VelSet]
type=velset
trigger1=!time
x = 4
ignorehitpause=1

[State 0, ChangeState]
type = ChangeState
trigger1= movehit ;movecontact ;moveguarded
value = 6866
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

[State 0, ChangeState]
type = ChangeState
trigger1= moveguarded
value = 6810
ctrl = 0
;anim =
;ignorehitpause =
;persistent =


[State 0, Cursed flag detection]
type = ParentVarSet
trigger1 = (pos x!=[-240,240])
var(49) = 0
;ignorehitpause =
;persistent =

[State 0, DestroySelf]
type = DestroySelf
;trigger1 = (movetype=A) && (rootdist X>=0)
;trigger2 = time>70 ;safevalue
trigger1 = (pos x!=[-240,240])
;ignorehitpause =
;persistent =

;Frozen Ball Vanish
[Statedef 6866]
type = A
movetype = A ;I
physics = N
ctrl = 0
sprpriority = 10

[State 0, Cursed flag detection]
type = ParentVarSet
trigger1= animtime<0 ;!time ;&& numtarget
var(49) = 2
ignorehitpause = 1
;persistent =

[State 0, P2 redirection]
type= targetstate
trigger1= !time && numtarget
value= 6876

[State -2, Time Display helper]
type = Helper
trigger1= !time && numtarget
trigger1 = !NumHelper(8888)
id = 8888
name = "Time display"
pos = 0,-50
postype = p2
stateno = 8888
pausemovetime = 999999
supermovetime = 999999
helpertype = normal
keyctrl = 0
ownpal = 1
ignorehitpause = 1

[state 1501, Counter Set]
type = ParentVarAdd ;ParentVarSet
trigger1= !time && numtarget
var(35)=180
;ignorehitpause =
;persistent =

[State 0, Cursed flag detection]
type = ParentVarSet
trigger1 = !animtime
var(49) = 0
;ignorehitpause =
;persistent =

[State 0, VelSet]
type = VelSet
trigger1 = !time
x = 0
y = 0

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
;value2 = S,NA
time = 1
;ignorehitpause =
;persistent =


[state 0, remove afterimage]
type = afterimagetime
trigger1 = !time
time = 0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6810

[State 3020, Sparks]
type=explod
trigger1= !time
anim=6806
sprpriority=9
postype=p1
pos= 0,22 ;-10, -40 ;(target,const(size.ground.front)-2),0 ;-62 ;-77;floor(p2dist y)
bindtime = -1
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 10231, Broken]
type = playsnd
trigger1 = !time
value = 20000,0

[State 0, DestroySelf]
type = DestroySelf
trigger1 = !animtime
;ignorehitpause =
;persistent =

;Frozen State
[Statedef 6876]
type = U
movetype = H
physics = N ;U
ctrl = 0

[State 0, VelSet]
type = VelSet
trigger1 = !time
x = 0
y = 0
;ignorehitpause =
;persistent =

[State 0, PosFreeze]
type = PosFreeze
trigger1 =1
value = 1
;ignorehitpause =
;persistent =


[State 0, Blue Ice]
type = PalFX
trigger1 = 1
time = 1
add = 0,50,240
mul = 120,224,150
sinadd = 85,55,110,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 0, ChangeAnim2]
type = null;ChangeAnim
triggerall = NumEnemy
triggerall = enemy,name = "Babidi Z2"
trigger1 = 1
value = enemy,var(42) ;Anim
elem = enemy,var(43) ;1
ignorehitpause = 1
;persistent =


[State 0, ChangeAnim2]
type = ChangeAnim
trigger1 = selfanimexist(anim)
value = anim
elem = animelemno(0)


[State 2405, ChangeState]
type = SelfState
triggerall = NumEnemy
triggerall = enemy,name = "Babidi Z2"
trigger1 =  enemy,var(35)<=0 ;time=180
value = 5070 ;enemy,var(41)
;ctrl = 1

;PONG LV3
[Statedef 6900]
type = A
movetype = A ;I
physics = N
ctrl = 0
sprpriority = -10

[State 0, VelSet Ini]
type = VelSet
trigger1 = !time
x = 3
y = 4
ignorehitpause = 1

[State 0, VelSet V]
type = VelSet
trigger1 = pos y>=0
y = -4
ignorehitpause = 1

[State 0, VelSet >]
type = VelSet
trigger1 = FrontEdgeDist<=0
x = -3
ignorehitpause = 1

[State 0, VelSet ^]
type = VelSet
trigger1 = Screenpos Y <=0
y = 4
ignorehitpause = 1

[State 0, VelSet <]
type = VelSet
trigger1 = BackEdgeDist<=0
x = 3
ignorehitpause = 1

[State 200, bounce snd]
type = PlaySnd
trigger1 = pos y>=0
trigger2 = FrontEdgeDist<=0
trigger3 = Screenpos Y <=0
trigger4 = BackEdgeDist<=0
value = 0,50
volume = 300


[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 0, AfterImage]
type = AfterImage
trigger1 = !time
time = -1
palcolor = 0
palinvertall = 0
palbright = 30,30,30
palcontrast = 120,120,220
palpostbright = 0,0,0
paladd = 50,50,50
timegap = 3
framegap = 3

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6800

[State 3410, NotHitBy]
type = NotHitBy
trigger1 = Time >= 0
time = 1
value = SCA, NT, ST, HT
ignorehitpause = 1

[State 3410, HitBy]
type = HitBy
trigger1 = Time >= 0
value = SCA, NA, SA, HA, NP, SP, HP
time = 1
ignorehitpause = 1

[State 3410, HitOverride]
type = HitOverride
trigger1 = Time >= 0
slot = 1
time = 1
stateno = 6810
attr = SCA, NA, SA, HA, NP, SP, HP
ignorehitpause = 1

[State 200, crystal woosh]
type = PlaySnd
trigger1 = time=4
value = 0, 2
channel = 1

[State 200, 1]
type = HitDef
trigger1 = 1
attr = S, HP
damage = 0, 0
animtype = Hard
guardflag = MA
hitflag = MAF
priority = 4, Hit
pausetime = 1,20 ;13
guard.pausetime = 0,13
sparkno = -1 ;s7030
guard.sparkno = -1 ;s7000
sparkxy = -20,-75
hitsound = s6800, 2
guardsound = S6,1
ground.type = High
ground.slidetime = 0 ;15
ground.hittime  = 18
ground.velocity = -7
ground.cornerpush.veloff = 0
guard.velocity = -9
airguard.velocity = -2.5,-1.3
air.type = High
air.velocity = -4,-4
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 35,35
yaccel = 0.5
ID = 6900
;palfx.time = 13
;palfx.mul = 128,128,128
;palfx.add = 50,50,50
;palfx.sinadd = 0,0,0,1
;palfx.color = 0
p1stateno = 6910 ;6912
p2stateno = 6920
persistent = 0


[State 3020, Sparks]
type=explod
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim=17100
sprpriority=-7
postype=p2
pos= 0, 0 ;(target,const(size.ground.front)-2),0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 3020, Guard Sparks]
type=explod
trigger1= moveguarded
anim=17100
sprpriority=-7
postype=p2
pos= 0, 0 ;(target,const(size.ground.front)-2), 0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 0, Vanish if Babidi is hit]
type = ChangeState
;trigger1 =  root,movetype=H
trigger1 = time>180 ;safevalue
value = 6810
ctrl = 0

[State 0, DestroySelf]
type = DestroySelf
;trigger1 = (movetype=A) && (rootdist X>=0)
;trigger2 = time>70 ;safevalue
trigger1 = time=190
;ignorehitpause =
;persistent =


;Lv.3 Crystal Ball
[Statedef 6910]
type = S
ctrl = 0
anim = 9999 ;0
velset = 0,0
movetype = A ;I
physics = S
sprpriority = 1

[state -3, remove afterimage]
type = afterimagetime
trigger1 = !time
time = 0
ignorehitpause = 1

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
;value2 = S,NA
time = 1
ignorehitpause = 1
;persistent =

[State 0, Timer Freeze]
type = AssertSpecial
trigger1 = 1
flag = timerfreeze
flag = invisible
ignorehitpause = 1

[State 0, EnvColor]
type = EnvColor
trigger1 = !time
value = 255,255,255
time = 11
;under = 0
;ignorehitpause =
;persistent =

[State 0, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1
;persistent =


[State 3010, Helper Limiter]
type = Helper
triggerall = !NumHelper(9999)
trigger1 =  !time
helpertype = normal
name =  "Limiter"
ID = 9999
stateno = 9999
pos = 0,0
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
supermovetime = 9999
pausemovetime = 9999

[State 784, AssertSpecial]
type = null ;AssertSpecial
trigger1 = time>0
flag = invisible
ignorehitpause = 1

[State 784, AssertSpecial]
type = AssertSpecial
trigger1 = time>0
flag = noBG
flag2 = noFG
flag3 = nobardisplay
ignorehitpause = 1


[State 784, bgpalfx1]
type = palfx
trigger1 = time = [10,20]
time = 256
color=256
mul=256,256,256
add = -256+25*(time-10),-256+25*(time-10),-256+25*(time-10)

[State 784, PosSet]
type = PosSet
trigger1 = !time ;time=1
x = 0
y = 0

[state 784, Back]
type = explod
trigger1 = !time ;time=1
anim = 786
ID = 786
pos = 0,60
postype=P2 ;P1
sprpriority=7
ownpal = 1
removetime = -1
bindtime = 1 ;-1
trans = addalpha
alpha = 64,128 ;64,256
ignorehitpause=1

[state 784, Babidi]
type = explod
trigger1 = !time ;time=1
anim = 784
ID = 784
pos = 0,60
postype=P2 ;P1
sprpriority=8
ownpal = 0
removetime = -1
bindtime = 1 ;-1


[state 784, Front]
type = explod
trigger1 = !time ;time=1
anim = 787
ID = 787
pos = 0,60
postype=P2 ;P1
sprpriority=9
ownpal = 1
removetime = -1
bindtime = 1 ;-1
trans = addalpha
alpha = 64,128 ;64,256


[state 784, Reflection]
type = explod
trigger1 = !time ;time=1
anim = 785
ID = 785
pos = 0,60
postype=P2 ;P1
sprpriority=10
ownpal = 1
removetime = -1
bindtime = 1 ;-1
trans = addalpha
alpha = 64,128 ;64,256

[State 784, Babidi voice]
type = PlaySnd
trigger1 = Time = 1
value = 9100,2+random%4
volume = 0
channel = 8
;abspan =
;ignorehitpause =
;persistent =

[State 0, Randomizer]
type = Varset
trigger1 = NumTarget
trigger1 = target,stateno=6920
trigger1 = target,time=1 ;10
trigger1 = var(48):=(1+random%6)
var(47)=IfElse(var(47)=var(48),var(47)^7,var(48))
;ignorehitpause =
;persistent =

[State -2, Special Projectile]
type = Projectile
triggerall = NumTarget
triggerall = target,stateno=6920
triggerall = target,time=1 ;10
trigger1 = NumHelper(9999)
trigger2 = !NumHelper(9999) ;last
ProjID = 3900
projanim = 3900
postype = p2
offset = 0, -30
attr = A, NP
hitflag = MAFD
;guardflag =
damage = 0,0
pausetime = 0, 15
ground.hittime = 15
air.hittime = 15
down.hittime = 15
sparkno = -1
hitsound = -1
numhits = 0
getpower = 0,0
p2sprpriority = 2
p2stateno = 6920+var(47) ;6921+random%6

;Special Status Sparks and SND
[State 3020, Twisted Sparks]
type=explod
triggerall = NumTarget
triggerall = target,anim!=5937
triggerall = target,anim!=5250
trigger1 = target,stateno=6922
trigger1 = target,time=1
anim=6802
sprpriority=7
postype=p2
pos= 0, 0 ;(target,const(size.ground.front)-2), 0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
pausemovetime=100
supermovetime=100

[State 200, twisted SND]
type = PlaySnd
trigger1 = NumTarget
trigger1 = target,stateno=6922
trigger1 = target,time=1
value = 7,1
volume = 300

[State 1000, Lapidation Helper]
type = Helper
trigger1 = NumTarget
trigger1 = target,stateno=6923
trigger1 = time%5
;trigger1 = time>=23 && time<70 && !(time%5) && numhelper(19890)<80 && numhelper(19891)<80
helpertype = Normal
name = "rocks"
id = 66920
pos = 160,20
postype = left
facing = 1
stateno = 66920
keyctrl = 0
ownpal = 1
supermovetime = 9999
pausemovetime = 9999

[State 200, lapidated SND]
type = PlaySnd
trigger1 = NumHelper(66921)>0 ;rocks
trigger1 = time%15=0
value = 6853,1
volume = 300

[State 9990, Burned Sparks]
type = Explod
;;triggerall = enemy,anim!=7697
;;triggerall = enemy,anim!=9015
trigger1 = NumTarget
trigger1 = target,stateno=6924
trigger1 = target,time=1
anim = 8600
ID = 8600
pos = 5,-45  ;(enemynear,const(size.mid.pos.x))-20,(enemynear,const(size.mid.pos.y))-10
postype = p2
removetime = -2 ;120
sprpriority = 3
bindtime = -1
ownpal = 1
facing = IfElse(random<500,1,-1) ;-1


[State 9990, Burned Sparks]
type = Explod
;;triggerall = enemy,anim!=7697
;;triggerall = enemy,anim!=9015
trigger1 = NumTarget
trigger1 = target,stateno=6924
trigger1 = target,time=1
anim = 8601
ID = 8601
pos = 15,-10   ;(enemynear,const(size.mid.pos.x))-40,(enemynear,const(size.mid.pos.y))+10
postype = p2
removetime = -2 ;120
sprpriority = 3
bindtime = -1
ownpal = 1
facing = IfElse(random<500,1,-1) ;-1

[State 9990, Burned Sparks]
type = Explod
;;triggerall = enemy,anim!=7697
;;triggerall = enemy,anim!=9015
trigger1 = NumTarget
trigger1 = target,stateno=6924
trigger1 = target,time=1
anim = 8601
ID = 8602
pos = -15,-20   ;(enemynear,const(size.mid.pos.x))+10,(enemynear,const(size.mid.pos.y))-30
postype = p2
removetime = -2 ;120
sprpriority = 4
bindtime = -1
ownpal = 1
facing = IfElse(random<500,1,-1) ;-1

[State 200, burned SND]
type = PlaySnd
trigger1 = NumTarget
trigger1 = target,stateno=6924
trigger1 = target,time=1
value = 734,0
volume = 300

[State 3020, Shocked Sparks]
type=explod
;triggerall = enemy,anim!=7696
;triggerall = enemy,anim!=9010
triggerall = NumTarget
triggerall = target,anim!=7696
triggerall = target,anim!=9010
trigger1 = target,stateno=6925
trigger1 = target,time=1
anim=2430
sprpriority=7
postype=p2
pos= -10, -40 ;(target,const(size.ground.front)-2), 0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
pausemovetime=100
supermovetime=100


[State 200, shocked SND]
type = PlaySnd
trigger1 = NumTarget
trigger1 = target,stateno=6925
trigger1 = target,time=1
value = 2400,2
volume = 300

[State 3020, Frozen Sparks]
type=explod
triggerall = NumTarget
triggerall = target,anim!=9016
trigger1 = target,stateno=6926
trigger1 = target,time=1
anim=6806
sprpriority=7
postype=p2
pos= 0,-20 ;-10, -40 ;(target,const(size.ground.front)-2), 0 ;-62 ;-77;floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
pausemovetime=100
supermovetime=100


[State 0, RemoveExplod]
type = RemoveExplod
triggerall = NumTarget
trigger1 = target,stateno=6927
id = 784
[State 0, RemoveExplod]
type = RemoveExplod
triggerall = NumTarget
trigger1 = target,stateno=6927
id = 785
[State 0, RemoveExplod]
type = RemoveExplod
triggerall = NumTarget
trigger1 = target,stateno=6927
id = 786
[State 0, RemoveExplod]
type = RemoveExplod
triggerall = NumTarget
trigger1 = target,stateno=6927
id = 787

[State 0, DestroySelf]
type = DestroySelf
triggerall = NumTarget
trigger1 = target,stateno=6927
ignorehitpause = 1
;persistent =


;Lv.3 - CB Out
[Statedef 6911]
type = S
ctrl = 0
;anim = 788
velset = 0,0
movetype = I
physics = S
sprpriority = 1

[State 0, Timer Freeze]
type = AssertSpecial
trigger1 = 1
flag = timerfreeze
ignorehitpause = 1


[State 0, EnvColor]
type = EnvColor
trigger1 = !time
value = 255,255,255
time = 11
;under = 0
;ignorehitpause =
;persistent =

[State 0, PosSet]
type = null ;PosSet
trigger1 = !time
x = IfElse(facing=1,-80,80)
y = var(52)
;ignorehitpause =
;persistent =

[State 0, Laugh]
type = PlaySnd
trigger1 = time=1
value = 9100,6
volume = 300
channel = 0
persistent = 0

[State 784, bgpalfx1]
type = bgpalfx
trigger1 = time = [10,20]
time = 256
color=256
mul=256,256,256
add = -256+25*(time-10),-256+25*(time-10),-256+25*(time-10)

[State 0, ChangeState]
type = ChangeState
trigger1 = time=20
value = 0
ctrl = 1
;anim =
;ignorehitpause =
;persistent =

;Pong Hit Vanish
[Statedef 6912]
type = A
movetype = A ;I
physics = N
ctrl = 0
sprpriority = 10

[State 0, AngleDraw]
type = AngleDraw
trigger1 = !time
value = 0
;scale =
;ignorehitpause =
;persistent =

[State 0, VelSet]
type = VelSet
trigger1 = !time
x = 0
y = 0

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
;value2 = S,NA
time = 1
;ignorehitpause =
;persistent =


[state 0, remove afterimage]
type = afterimagetime
trigger1 = !time
time = 0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1
;persistent =

[State 3302, anim]
type = changeanim
trigger1 = !time
value = 6810


[State 0, DestroySelf]
type = DestroySelf
trigger1 = !animtime
;ignorehitpause =
;persistent =


;Lv.3 - Enemy in Crystal ball
[Statedef 6920]
type = S
movetype = H
physics = N
sprpriority = 2
ctrl = 0

[State 0, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1
;persistent =

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = 5000 ;0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
flag2 = noBG
flag3 = noFG


[State 0, PosSet]
type = PosSet
trigger1 = 1
x = 0
y = 0 ;0
;ignorehitpause =
;persistent =

[State 0, SelfState]
type = SelfState
trigger1 = time=250
value = 0
;anim =
ctrl = 1
;ignorehitpause = 0
;persistent = 1

;Hit in CB - Poisoned
[Statedef 6921]
type = U
movetype = H
physics = N ;A
ctrl = 0
velset = 0,0
poweradd = 0
sprpriority = 2

[State 0, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1


[State 7696, Anim]
type = changeanim
trigger1 = !time
trigger1 = anim != 5300 && selfanimexist(5300)
value = 5300

[State 7696, Anim]
type = changeanim
trigger1 = !time
trigger1 = !selfanimexist(5300)
value = 5010

[State 0, Green Poison]
type = PalFX
trigger1 = 1
time = 1
add = 0,100,50
mul = 20,120,24
sinadd = 85,110,55,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1


[State 0, ChangeState]
type = ChangeState
trigger1 = time=30
value = IfElse((enemy,NumHelper(9999)=1),6920,6927)
ctrl = 0
;anim =
;ignorehitpause =
;persistent =

;Hit in CB - Twisted
[Statedef 6922]
type = U
physics = N
movetype = H
ctrl = 0
velset = 0, 0

[State 0, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

[State 7696, Anim]
type = changeanim
trigger1 = !time
trigger1 = anim != 5937 && selfanimexist(5937)
value = 5937
[State 7696, Anim]
type = changeanim
trigger1 = !time
trigger1 = anim != 9010 && !selfanimexist(5937) && selfanimexist(5250)
value = 5250
[State 7696, Anim]
type = changeanim
trigger1 = !time
trigger1 = !selfanimexist(5937) && !selfanimexist(5250)
value = ifelse(statetype != A, 5002, 5030)

[State 7696, nopalfx]
type = palfx
trigger1 = !time
trigger1 = (anim = 5937 || anim = 5250)
add = 0, 0, 0
time = 1

[State 0, Yellow Lightning]
type = PalFX
trigger1 = (anim != 5937 && anim != 5250)
time = 1
add = 40,-70,-200
mul = 256,256,256
sinadd = 40,30,0,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 7696, End]
type = changestate
trigger1 = alive && (anim = 5937 || anim = 5250) && hitshakeover
trigger2 = alive && (anim != 5937 && anim != 5250) && hitshakeover
value = IfElse((enemy,NumHelper(9999)=1),6920,6927)

;Hit in CB - Lapidated
[Statedef 6923]
type = U
physics = N
movetype = H
ctrl = 0
velset = 0, 0

[State 0, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

[State 7696, Anim]
type = changeanim
trigger1 = !time
value = 5010

[State 0, Gray Stone]
type = PalFX
trigger1 = 1
time = 1
add = 50,50,50
mul = 128,128,128
sinadd = 0,0,0,1
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1


[State 7696, End]
type = changestate
trigger1 = alive && time=80 ;hitshakeover
value = IfElse((enemy,NumHelper(9999)=1),6920,6927)

;Hit in CB - Burned
[Statedef 6924]
type = U
physics = N
movetype = H
ctrl = 0
velset = 0, 0

[State 0, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

[State 0, PosSet]
type = null ;PosAdd
trigger1 = !time
x = 20
;ignorehitpause =
;persistent =


[State 7696, Anim]
type = changeanim
trigger1 = !time
trigger1 = anim != 7697 && selfanimexist(7697)
value = 7697
[State 7696, Anim]
type = changeanim
trigger1 = !time
trigger1 = anim != 9015 && !selfanimexist(7696) && selfanimexist(9015)
value = 9015
[State 7696, Anim]
type = changeanim
trigger1 = !time
trigger1 = !selfanimexist(7697) && !selfanimexist(9015)
value = ifelse(statetype != A, 5002, 5030)

[State 7696, nopalfx]
type = palfx
trigger1 = !time
trigger1 = (anim = 7697 || anim = 9015)
add = 0, 0, 0
time = 1

[State 0, Red Fire]
type = PalFX
trigger1 = (anim != 7697 && anim != 9015)
time = 1
add = 0,-200,-200
mul = 256,256,256
sinadd = 40,80,40,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 7696, End]
type = changestate
trigger1 = alive && (anim = 7697 || anim = 9015) && hitshakeover
trigger2 = alive && (anim != 7697 && anim != 9015) && time=52 ;hitshakeover
value = IfElse((enemy,NumHelper(9999)=1),6920,6927)


;Hit in CB - Shocked
[Statedef 6925]
type = U
physics = N
movetype = H
ctrl = 0
velset = 0, 0

[State 0, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

[State 7696, Anim]
type = changeanim
trigger1 = !time
trigger1 = anim != 7696 && selfanimexist(7696)
value = 7696
[State 7696, Anim]
type = changeanim
trigger1 = !time
trigger1 = anim != 9010 && !selfanimexist(7696) && selfanimexist(9010)
value = 9010
[State 7696, Anim]
type = changeanim
trigger1 = !time
trigger1 = !selfanimexist(7696) && !selfanimexist(9010)
value = ifelse(statetype != A, 5002, 5030)

[State 0, PosSet]
type = PosAdd
trigger1 = !time
trigger1 = (anim = 7696 || anim = 9010)
x = 20
;ignorehitpause =
;persistent =

[State 7696, nopalfx]
type = palfx
trigger1 = !time
trigger1 = (anim = 7696 || anim = 9010)
add = 0, 0, 0
time = 1

[State 0, Yellow Lightning]
type = PalFX
trigger1 = (anim != 7696 && anim != 9010)
time = 1
add = 40,40,-200
mul = 256,256,256
sinadd = 40,30,0,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1

[State 7696, End]
type = changestate
trigger1 = alive && (anim = 7696 || anim = 9010) && hitshakeover
trigger2 = alive && (anim != 7696 && anim != 9010) && hitshakeover
value = IfElse((enemy,NumHelper(9999)=1),6920,6927)


;Hit in CB - Frozen
[Statedef 6926]
type = U
physics = N
movetype = H
ctrl = 0
velset = 0, 0

[State 0, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

[State 7696, Anim]
type = changeanim
trigger1 = !time
trigger1 = anim != 9016 && selfanimexist(9016)
value = 9016
[State 7696, Anim]
type = changeanim
trigger1 = !time
trigger1 = !selfanimexist(9016)
value = ifelse(statetype != A, 5002, 5030)

[State 7696, Freeze Anim]
type = changeanim
triggerall = anim != 9016
trigger1 = time>0
value = anim
elem = animelemno(0)

[State 0, Blue Ice]
type = PalFX
trigger1 = anim != 9016
time = 1
add = 0,50,240
mul = 120,224,150
sinadd = 85,55,110,10
invertall = 0
color = 0
;ignorehitpause = 0
;persistent = 1


[State 7696, nopalfx]
type = palfx
trigger1 = !time
trigger1 = (anim = 9016)
add = 0, 0, 0
time = 1

[State 7696, End]
type = changestate
trigger1 = alive && (anim = 9016) && hitshakeover
trigger2 = alive && (anim != 9016) && time=15 ;hitshakeover
value = IfElse((enemy,NumHelper(9999)=1),6920,6927)

;Hit in CB - Ender
[Statedef 6927]
type = S
physics = S
movetype = H
ctrl = 0
velset = 0, 0

[State 0, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1


[State 0, LifeAdd]
type = LifeAdd
trigger1 = !time
value = -350
kill = 1
absolute = 1
ignorehitpause = 1

[State 7696, Anim]
type = changeanim
trigger1 = 1
value = 5070


[State 0, PosSet]
type = PosSet
trigger1 = time=1
x = IfElse(facing=1,-80,80)
y = 0
;ignorehitpause =
;persistent =

[State 7696, End]
type = SelfState
trigger1 = time=12 ;time=20 ;2
value = 5070

;Stone generator
[Statedef 66920]
type = A
movetype = I
physics = N
anim = 15999

[State 1003, Helper ^]
type = Helper
trigger1 = !time
helpertype = Normal
name = "rocks"
id = 66921
pos = random%320,240
postype = left
facing = facing ;1
stateno = 66921
keyctrl = 0
ownpal = 1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
size.xscale = .25
size.yscale = .25

[State 1003, Helper >]
type = Helper
trigger1 = !time
helpertype = Normal
name = "rocks"
id = 66921
pos = 0,-random%240
postype = left
facing = facing ;1
stateno = 66921
keyctrl = 0
ownpal = 1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
size.xscale = .25
size.yscale = .25

[State 1003, Helper <]
type = Helper
trigger1 = !time
helpertype = Normal
name = "rocks"
id = 66921
pos = 320,-random%240
postype = left
facing = facing ;1
stateno = 66921
keyctrl = 0
ownpal = 1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
size.xscale = .25
size.yscale = .25

[State 1003, Helper V]
type = Helper
trigger1 = !time
helpertype = Normal
name = "rocks"
id = 66921
pos = random%320,-240
postype = left
facing = facing ;1
stateno = 66921
keyctrl = 0
ownpal = 1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
size.xscale = .25
size.yscale = .25

[State 1003, DestroySelf]
type = DestroySelf
trigger1 = time=2
trigger2 = enemy,stateno!=6923

;Stones
[Statedef 66921]
type = A
movetype = I
physics = N
anim = 19890 + random%6
sprpriority = 5

;Formula to find the components of a given vector AB
;V(x) = B(x) - A(x)
;V(y) = B(y) - A(y)
[State 1640, X]
Type = VarSet
Trigger1 = !time ;1
fvar(1) = (EnemyNear(0),Pos X - Pos X) * Facing
;Finds the Y component of the vector Player, EnemyNear
[State 1640, Y]
Type = VarSet
Trigger1 = !time ;1
fvar(2) = (EnemyNear(0),Const(size.head.pos.y) - Pos Y) * Facing

;Finds the vector length
;Formula of the length of a given vector AB
;|AB| = (AB(x)^2  + AB(y)^2)^1/2
[State 1640, Vector Length]
Type = VarSet
Trigger1 = !time
fvar(3) = Exp(0.5*ln((fvar(1) * fvar(1))+(fvar(2) * fvar(2))))
[State 37001, Velocity 0]
type = VelSet
trigger1 = Time = 0
x = 7*(Fvar(1)/fvar(3))
y = 7*(FVar(2)/fvar(3))

[State 1004, assert]
type = assertspecial
trigger1 = 1
flag = noshadow

[State 1004, vel]
type = varset
trigger1 = !time
var(10) = random%2

[State 1004, assert]
type = angledraw
trigger1 = 1
value = ifelse(var(10)=0,5*time,-5*time)

[State 1004, DestroySelf]
type = DestroySelf
trigger1 = Pos X =[-20,20]
trigger2 = enemy,stateno!=6923
;trigger1 = Pos Y =[-80,10]

; Time Display
[Statedef 8888]
type=A
movetype=I
physics=N
anim= 9999
ctrl=0

[State -2, 000]
type = Explod
trigger1 = root,var(35)>=100
anim = 8880+ceil(root,var(35)/1.0)/100
ID = 8888
pos = IfElse(enemynear,facing=1,-7,7),-130
postype = p2
facing = enemynear,facing
vfacing = 1
bindtime = -1
vel = 0,0
accel = 0,0
random = 0,0
removetime = 1
pausemovetime = 9999
scale = 1,1
sprpriority = 10
ontop = 0
shadow = 0,0,0
ownpal = 0
removeongethit = 0
ignorehitpause = 1


[State -2, 00]
type = Explod
trigger1 = root,var(35)>=10
anim = 8880+floor(root,var(35)/10.0)%10
ID = 8888
pos = 0,-130
postype = p2
facing = enemynear,facing
vfacing = 1
bindtime = -1
vel = 0,0
accel = 0,0
random = 0,0
removetime = 1
pausemovetime = 9999
scale = 1,1
sprpriority = 10
ontop = 0
shadow = 0,0,0
ownpal = 0
removeongethit = 0
ignorehitpause = 1

[State -2, 0]
type = Explod
trigger1 = root,var(35)>=0
anim = 8880+ceil(root,var(35)/1.0)%10
ID = 8888
pos = IfElse(enemynear,facing=1,7,-7),-130
postype = p2
facing = enemynear,facing
vfacing = 1
bindtime = -1
vel = 0,0
accel = 0,0
random = 0,0
removetime = 1
pausemovetime = 9999
scale = 1,1
sprpriority = 10
ontop = 0
shadow = 0,0,0
ownpal = 0
removeongethit = 0
ignorehitpause = 1

[State 0, Blue PalFX]
type = PalFX
trigger1 = root,var(35)=(10,30)
time = 1
add = -200,-200,7
mul = 256,256,256
sinadd = 0,30,30,10
invertall = 0
color = 0
ignorehitpause = 1


[State 0, Red PalFX]
type = PalFX
trigger1 = root,var(35)<=10
time = 1
add = 7,-200,-200
mul = 256,256,256
sinadd = 30,30,0,10
invertall = 0
color = 0
ignorehitpause = 1



[State 1100, kill]
type=destroyself
trigger1= root,var(35)<=0


;======================================================================
;LAND FX
[Statedef 17100]
type=A
movetype=I
physics=N
anim=15999
sprpriority=1
velset=0,0

[state 17100,bind]
type = bindtoparent
trigger1 = !time
pos = -11,0

[state 17100, Landing Effect]
type=explod
trigger1=!time
anim=17100
id=17100
pos=0,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1

[state 17100]
type=removeexplod
trigger1=time>10

[State 17100]
type=destroyself
trigger1=time>10

;Babidi Necromancer
[Statedef 9110]
type = A
movetype = I
physics = N
ctrl = 0
;anim = 0
velset = 0,0
sprpriority = 8 ;-10

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 =!time
value = 1801
;elem = 1
;ignorehitpause =
;persistent =

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = Anim=1801
trigger1 = !animtime
value = 0
;elem = 1
;ignorehitpause =
;persistent =



[State 1900, Power Lamp explod]
type = explod
triggerall= Anim=0
triggerall = !NumExplod(910)
trigger1 = Animelemtime(1)=0
anim = 910
id = 910
pos = 0,0
sprpriority = 6
bindtime = -1
ownpal = 0
removeongethit = 1
ignorehitpause = 1
facing = 1
removetime = -1 ;-2

[State 0, PlaySnd]
type = PlaySnd
triggerall= Anim=0
trigger1 = Animelemtime(1)=0
value = 2400,10
volume = 0
channel = -1


[State 0, Remove Power Lamp]
type = RemoveExplod
trigger1 = time=108
id =910
;ignorehitpause =
;persistent =

[State 1900, Lamp]
type = explod
triggerall = !NumExplod(805)
trigger1 = time = 108
anim = 805
id = 805
pos = 0,0
sprpriority = 6
bindtime = -1
ownpal = 0
removeongethit = 1
ignorehitpause = 1
facing = 1
removetime = -1


[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 1


[State 0, Remove Lamp]
type = RemoveExplod
trigger1 = time = 158 ;!animtime
id =805
;ignorehitpause =
;persistent =


[State 3010, Babidi talk]
type = Explod
triggerall= Anim=0
trigger1 = Animelemtime(1)=0
anim =  195
ID =  9110
pos = 0,0
postype = p1 ;p2,front,back,left,right
supermovetime = 9999
pausemovetime = 9999
facing = 1
vfacing = 1
bindtime = -1
removetime = -1
scale = 1,1
sprpriority = 10 ;-8
ownpal = 1
removeongethit = 0
ignorehitpause = 1

[State 0, Remove Talk]
type = RemoveExplod
trigger1 = Root,StateNo=0
trigger2 = time=420 ;110 ;Necromancer
id = 9110

[State 9105, DestroySelf]
type = DestroySelf
trigger1 = Root,StateNo=0

;----------------------------------------------------
; Limiter Flames
[Statedef 9990]
type = S
velset = 0,0
sprpriority = 0
anim = 15999
ctrl = 0

[State 9990, Explod]
type = Explod
trigger1 = time = 0
anim = 8600
ID = 8600
pos = 5,-45  ;(enemynear,const(size.mid.pos.x))-20,(enemynear,const(size.mid.pos.y))-10
postype = p2
removetime = 120
sprpriority = 3
bindtime = -1
ownpal = 1
facing = IfElse(random<500,1,-1) ;-1

[State 9990, Explod]
type = Explod
trigger1 = time = 0
anim = 8601
ID = 8601
pos = 15,-10   ;(enemynear,const(size.mid.pos.x))-40,(enemynear,const(size.mid.pos.y))+10
postype = p2
removetime = 120
sprpriority = 3
bindtime = -1
ownpal = 1
facing = IfElse(random<500,1,-1) ;-1

[State 9990, Explod]
type = Explod
trigger1 = time = 0
anim = 8601
ID = 8602
pos = -15,-20   ;(enemynear,const(size.mid.pos.x))+10,(enemynear,const(size.mid.pos.y))-30
postype = p2
removetime = 120
sprpriority = 4
bindtime = -1
ownpal = 1
facing = IfElse(random<500,1,-1) ;-1

[State 9990, ModifyExplod]
type = ModifyExplod
trigger1 = time = [110,120]
anim = 8600
ID = 8600
pos = 5,-45
postype = p2
facing = IfElse(random<500,1,-1) ;-1
trans = addalpha
alpha = 256-25*(time-110),0+25*(time-110)

[State 9990, ModifyExplod]
type = ModifyExplod
trigger1 = time = [110,120]
anim = 8601
ID = 8601
pos = 15,-10
postype = p2
facing = IfElse(random<500,1,-1) ;-1
trans = addalpha
alpha = 256-25*(time-110),0+25*(time-110)

[State 9990, ModifyExplod]
type = ModifyExplod
trigger1 = time = [110,120]
anim = 8601
ID = 8602
pos = -15,-20
postype = p2
facing = IfElse(random<500,1,-1) ;-1
trans = addalpha
alpha = 256-25*(time-110),0+25*(time-110)


[State 9990, DestroySelf]
type = DestroySelf
trigger1 = time>=120

;======================================================================
; POWER CHARGE AURA

[Statedef 905]
type = A
movetype = I
physics = N
ctrl = 0
anim = 735
velset = 0,0
sprpriority = -1


[State 905, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = NoShadow

[State 905, NoShadow]
type = Trans
trigger1 = root,var(2)=0
trans = none
ignorehitpause = 1

[State 905, BindToParent]
type = BindToParent
trigger1 = 1
pos = 0,0


[State 905, Anim]
type = ChangeAnim
trigger1 = root,stateno = 901
value = 736
persistent = 0

[State 905, DestroySelf]
type = DestroySelf
trigger1 = (anim = 735) && (Root,StateNo != [900,901])
trigger2 = (anim = 736) && animtime = 0
trigger3 = Root,stateno = [5000,5090]






;======================================================================
; Repel helper : 1305
; Destroyed : 1306
; Reflect with random projectile : 1308
; Reflected projectile : 1315
; Reflected projectile explods : 1316
;======================================================================

; REPEL HELPER FOR SLASH CHOP

[Statedef 1305]
type = S
physics = N
movetype = A
ctrl = 0
sprpriority = 4

[State 1305, nothitby]
type = nothitby
trigger1 = 1
time = -1
value = SCA
ignorehitpause = 1

[State 1305, HB]
type = hitby
trigger1 = 1
time = 1
value = SCA, NP, SP, HP
ignorehitpause = 1

[State 1305, HitOverride]
type = hitoverride
trigger1 = 1
time = -1
attr = SCA, AA, AP, AT
stateno = 1306
ignorehitpause = 1

[State 1305, HitOverride]
type = hitoverride
trigger1 = 1
time = -1
attr = SCA, NP, SP,HP
stateno = 1308
ignorehitpause = 1

[State 1305, Anim]
type = changeanim
trigger1 = anim != 1305
value = 1305

[State 1305, timevar]
type = varadd
trigger1 = 1
var(4) = 1

[State 1305, Shadows]
type = afterimage
trigger1 = !time && !prevstateno
time = 999
timegap = 1
framegap = 4
length = 12
palcontrast = 30, 60, 120
trans = add

[State 1305, Type]
type = statetypeset
trigger1 = movecontact
movetype = I

[State 1305, End]
type = changestate
trigger1 = var(4) >= 13
value = 1306

;-----------------------------------------
; Destroyed
[Statedef 1306]
type = A
physics = N
movetype = I
velset = 0, 0
ctrl = 0
sprpriority = 1
anim = 15998

[State 3000, nhb]
type = nothitby
trigger1 = 1
time = 1
value = SCA
ignorehitpause = 1

[State 1306, End]
type = destroyself
trigger1 = !animtime

;-----------------------------------------
; Reflect with projectile
[Statedef 1308]
type = A
physics = N
movetype = I
ctrl = 0
anim = 15998

[State 1308, nothitby]
type = nothitby
trigger1 = 1
time = 1
value = SCA
ignorehitpause = 1

[State 1308, reflected]
type = helper
trigger1 = !time
helpertype = normal
stateno = 1315
ID = 1315
name = "Reflected"
postype = p1
pos = 25, -20
ownpal = 1
size.xscale = 1
size.yscale = 1

[State 1308, End]
type = changestate
trigger1 = 1
value = 1306   ;1305

;-----------------------------------------
; Reflected projectile Kamehameha
[Statedef 1315]
type=S
physics=N
movetype=A
ctrl=0
velset=0,0
sprpriority=4
poweradd = 100

[State 200, Ki goes SFX]
type = PlaySnd
trigger1 = !time
value = 10,0
channel = 1

[State -2, Explod];P1 Side.
type = Explod
trigger1 = !time && numexplod(13300)=0 && teamside = 1
anim = 13300
pos = 10,80
postype = left  ;p2,front,back,left,right
removetime = -2
supermove = 1
scale = 0.5,0.5
sprpriority = 0
id = 13300
bindtime = -1
ontop = 1
ownpal = 1
ignorehitpause = 1
pausemovetime = -1
persistent = 0

[State -2, Explod];P2 Side.
type = Explod
trigger1 = !time && numexplod(13300)=0 && teamside = 2
anim = 13301
pos = -95,80
postype = left
removetime = -2
supermove = 1
scale = 0.5,0.5
sprpriority = 0
id = 13300
bindtime = -1
ontop = 1
ownpal = 1
ignorehitpause = 1
pausemovetime = -1
persistent = 0

[State 1061, NoShadow]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[State 1061, NoShadow]
type = Trans
trigger1 = root,var(2)=0
trans = none
ignorehitpause = 1

[State 1315, HitOverride]
type=hitoverride
trigger1= 1
time=-1
attr=SCA,AA,AP,AT
stateno=1316
ignorehitpause=1

[State 1315, HB]
type=hitby
trigger1= 1
time=-1
value=SCA,NP,SP,HP
ignorehitpause=1

[state 1315]
type = varset
triggerall = numenemy
triggerall = enemy,authorname = "Balthazar & Cybaster"
trigger1 = enemy,name = "Goku Z2"
trigger2 = enemy,name = "SSJ Goku Z2"
trigger3 = enemy,name = "Vegeta Z2"
trigger4 = enemy,name = "Gohan Z2"
var(11) = 1

[State 1315, Anim];normal kamehameha FX (yellow/blue)
type=changeanim
trigger1= !time && !prevstateno && var(11)=0 && root,var(44)=0
value=1311
[State 1315, Anim];normal kamehameha FX (old purple)
type=changeanim
trigger1= !time && !prevstateno && var(11)=0 && root,var(44)>=1
value=1310
[State 1315, Anim];Vegeta kamehameha FX
type=changeanim
trigger1= !time && !prevstateno && var(11)=1
value=1010

[State 1315, Vel]
type=velset
trigger1= 1
x = 8

[State 1315, image]
type=afterimage
trigger1= !time && !prevstateno
time=999
timegap=1
framegap=2
length=5
palcontrast=50,50,200
trans=add

[State 1315, Hit]
type=hitdef
trigger1= 1
priority=4,Hit
attr = S,SP
damage = ceil(61*root,fvar(12)), ceil(6*root,fvar(12))
animtype = Hard
hitflag = MAF
guardflag=MA
pausetime=0,10
sparkno = -1
guard.sparkno = -1
sparkxy = -10,0
hitsound  = S1000,0
guardsound = S6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-10,0
ground.cornerpush.veloff=0
air.velocity=-4,-2
getpower= ifelse(p2movetype=H,40,140), 35
givepower = 35,35
envshake.time=14
envshake.freq=120
envshake.ampl=4
air.fall=1
fall.recover=1
fall.recovertime=16
yaccel=.5
airguard.ctrltime= 16
airguard.velocity= -8, -1.5
forcestand=1
p1sprpriority = 5

[State 1315, Sparks]
type=explod
trigger1= movehit && numtarget
trigger1= (target,movetype=H) && !(target,time)
anim=7020
sprpriority=3
postype=p2
pos=(target,const(size.ground.front)-10),-floor(p2dist y)
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 1315, End]
type=changestate
trigger1= movecontact
value=1316
ignorehitpause=1

[State 1315, End]
type=destroyself
trigger1=pos x!=[-200,200]

;-----------------------------------------
; Kamehameha explod/vanish
[Statedef 1316]
type=A
physics=N
movetype=I
velset=0,0
ctrl=0
sprpriority=4

[State 1308, nothitby]
type = nothitby
trigger1 = 1
time = 1
value = SCA
ignorehitpause = 1

[State 3005, anim];VS Z2 chars
type = changeanim
trigger1 = !time && var(11)=1
value = 1013
[State 3005, anim];Repel (old)
type = changeanim
trigger1 = !time && var(11)=0 && prevstateno=1315 && root,var(44)>=1
value = 1316
[State 3005, anim];Repel (yellow/blue)
type = changeanim
trigger1 = !time && var(11)=0 && prevstateno=1315 && root,var(44)=0
value = 1311

[State 1061, NoShadow]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[State 1061, NoShadow]
type = Trans
trigger1 = root,var(2)=0
trans = none
ignorehitpause = 1

[State 1316, End]
type=destroyself
trigger1= !animtime

;---------------------------
;Detect life Helper (Coded by 2OS)

[Statedef 2]

[State 2OS]
type = statetypeset
trigger1 = 1
movetype = I
ignorehitpause = 1
persistent = 1

[State 2OS, Blank Animation]
type = changeanim
trigger1 = 1
value = 15999
ignorehitpause = 1
persistent = 1

[State 2OS]
type = bindtoroot
trigger1 = 1
pos = 0,0
ignorehitpause = 1
persistent = 1

[State 2OS, Damage Var Delay Reset]
type = varset
trigger1 = var(1)>1
var(1) = 0
ignorehitpause = 1
persistent = 1

[State 2OS, Damage Var Delay]
type = varadd
trigger1 = var(2) != root,life
var(1) = 1
ignorehitpause = 1
persistent = 1

[State 2OS, Damage Var]
type = varset
trigger1 = (var(1)!=[0,1])
var(2) = root,life
ignorehitpause = 1
persistent = 1

;==========================================================
; SUPER BG - Street Fighter 3

[Statedef 19875]
type = S
velset = 0,0
sprpriority = 0
anim = 15999
ctrl = 0

[State 10500, snd]
type = playsnd
trigger1 = !time
value = 9,0

[State 10000, AssertSpecial]
type = AssertSpecial
trigger1 = time <= 55
flag = noFG

[State 10000, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nomusic

[State 10000, Explod]; White BG
type = Explod
trigger1 = time = 0
anim = 19877
id = 19875
pos =  160,120
postype = left
sprpriority = -7
facing = 1
bindtime = -1
ownpal = 1
removetime = 99999999999999
pausemovetime = 99999999999999
supermovetime = 99999999999999
supermove = 1
scale = 1.20,1.20
ignorehitpause = 1
persistent = 0

[State 10000, Explod SF3]
type = Explod
trigger1 = time = 0
anim = 19875
id = 10000
pos =  160,120
postype = left
sprpriority = -7
facing = 1
bindtime = -1
ownpal = 1
removetime = 9999999999999
pausemovetime = 99999999999999
supermovetime = 99999999999999
supermove = 1
scale = 1.20*0.9,1.20*1.05
ignorehitpause = 1
persistent = 0

[State 10000, pause]
type = Pause
trigger1 = Time = 0
time = 40
movetime = 40

[State 10000, RemoveExplod]
type = RemoveExplod
trigger1 = time = 44
id = 10000

[State 10000, RemoveExplod]
type = RemoveExplod
trigger1 = time = 55
id = 10500

[State 8020, End]
type = destroyself
trigger1 = !(roundstate>2)
trigger2 = time=1000

;==========================================================
; SUPER BG - Super DBZ (Physics)

[Statedef 19885]
type = S
velset = 0,0
sprpriority = 0
anim = 15999
ctrl = 0

[State 1000, shake]
type = EnvShake
trigger1 = !(time%4) && time<150
time=4
freq=80
ampl=7

[State 10500, snd]
type = playsnd
trigger1 = !time
value = 9,0

[State 10000, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noFG
flag2 = nokoslow
ignorehitpause = 1

[State 10000, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nomusic
flag2 = nobardisplay
ignorehitpause = 1

[State 10000, Explod]; White BG
type = Explod
trigger1 = time = 0
anim = 19884
id = 19884
pos =  160,120
postype = left
sprpriority = -4
facing = 1
bindtime = -1
ownpal = 1
pausemovetime = 99999999999999
supermovetime = 99999999999999
scale = 1.20,1.20
ignorehitpause = 1
persistent = 0
removetime = -2

[State 10000, Explod Krak]
type = Explod
trigger1 = time = 0
anim = 19885
id = 19885
pos =  160,120
postype = left
sprpriority = -7
facing = 1
bindtime = -1
ownpal = 1
removetime = 9999999999999
pausemovetime = 99999999999999
supermovetime = 99999999999999
supermove = 1
scale = 1,1
ignorehitpause = 1
persistent = 0

[State 10000, Scale Explod]
type = ModifyExplod
trigger1 = time>6
scale = 1+.01*time, 1+.01*time
id = 19885

[State 10000, RemoveExplod Krak]
type = RemoveExplod
trigger1 = time = 44
id = 19885

[State 10000, Explod Space BG]
type = Explod
trigger1 = time = 23
anim = 19886
id = 19886
pos =  160,120
postype = left
sprpriority = -7
facing = 1
bindtime = -1
ownpal = 1
removetime = 9999999999999
pausemovetime = 99999999999999
supermovetime = 99999999999999
scale = 1.3,1.3
ignorehitpause = 1
persistent = 0

[State 10000, Explod planet left]
type = Explod
trigger1 = time = 23
anim = 19887
id = 19886
pos =  0,240
postype = left
sprpriority = -6
facing = 1
ownpal = 1
removetime = 9999999999999
pausemovetime = 99999999999999
supermovetime = 99999999999999
scale = 1.2,1.2
ignorehitpause = 1
persistent = 0
;vel = -.2,0
bindtime = -1

[State 10000, Explod planet right]
type = Explod
trigger1 = time = 23
anim = 19888
id = 19886
pos =  320,240
postype = left
sprpriority = -6
facing = 1
ownpal = 1
removetime = 9999999999999
pausemovetime = 99999999999999
supermovetime = 99999999999999
scale = 1.2,1.2
ignorehitpause = 1
persistent = 0
;vel = .2,0
bindtime = -1

[State 1000, Helper]
type = Helper
trigger1 = time>=23 && time<70 && !(time%5) && numhelper(19890)<80 && numhelper(19891)<80
helpertype = Normal
name = "rocks"
id = 19890
pos = 160,20
postype = left
facing = 1
stateno = 19890
keyctrl = 0
ownpal = 1
supermovetime = 9999
pausemovetime = 9999

[State 13300, black screen fade]
type = Explod
trigger1 = Time = 60
anim = 19883   ;2771
ID = 2771
postype = left
pos = 0,-50
bindtime = -1
removetime = 91
pausemovetime = 91
ontop = 1
scale = 2,3

[State 10000, RemoveExplod Krak]
type = RemoveExplod
trigger1 = time = 150
id = 19886

[State 8020, End]
type = destroyself
trigger1 = !(roundstate>2)
trigger2 = time=150  ;1000

;------------------------------------------------------
;Rocks going up

[Statedef 19890]
type = A
movetype = I
physics = N
anim = 15999

[State 1003, Helper]
type = Helper
trigger1 = !time
helpertype = Normal
name = "rocks"
id = 19891
pos = ((random%320)),10*(random%13)
postype = left
facing = 1
stateno = 19891
keyctrl = 0
ownpal = 1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
size.xscale = .5
size.yscale = .5

[State 1003, Helper]
type = Helper
trigger1 = !time
helpertype = Normal
name = "rocks"
id = 19891
pos = ((random%320)+320),10*(random%13)
postype = left
facing = 1
stateno = 19891
keyctrl = 0
ownpal = 1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
size.xscale = .5
size.yscale = .5

[State 1003, Helper]
type = Helper
trigger1 = !time
helpertype = Normal
name = "rocks"
id = 19891
pos = ((random%320)-320),10*(random%13)
postype = left
facing = 1
stateno = 19891
keyctrl = 0
ownpal = 1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
size.xscale = .5
size.yscale = .5

[State 1003, DestroySelf]
type = DestroySelf
trigger1 = time=2

;-----------------
[Statedef 19891]
type = A
movetype = I
physics = N
anim = 19890 + random%6
sprpriority = -5

[State 1004, assert]
type = assertspecial
trigger1 = 1
flag = noshadow

[State 1004, vel]
type = velset
trigger1 = !time
y = -3-random%7

[State 1004, vel]
type = varset
trigger1 = !time
var(10) = random%2

[State 1004, assert]
type = angledraw
trigger1 = 1
value = ifelse(var(10)=0,5*time,-5*time)

[State 1004, DestroySelf]
type = DestroySelf
trigger1 = time > 300
trigger2 = pos Y < -340
trigger3 = root,stateno = 180

;==========================================================
; SUPER BG - Super DBZ (Ki attacks)

[Statedef 19892]
type = S
velset = 0,0
sprpriority = 0
anim = 15999
ctrl = 0

[State 3001, screen]
type = PosSet
trigger1 = !time
x = 0
y = -ceil(screenpos Y)
ignorehitpause = 1

[State 3001, screen]
type = PosSet
trigger1 = 1
x = 0
ignorehitpause = 1

[State 1000, shake]
type = EnvShake
trigger1 = !(time%4) && time<150
time=4
freq=80
ampl=7

[State 10500, snd]
type = playsnd
trigger1 = !time
value = 9,0

[State 10000, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noFG
flag2 = nokoslow
ignorehitpause = 1

[State 10000, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nomusic
flag2 = nobardisplay
ignorehitpause = 1

[State 10000, Explod]; White BG
type = Explod
trigger1 = !time
anim = 957
id = 11111
pos =  0,-30
postype = left
sprpriority = -7
facing = 1
bindtime = -1
ownpal = 1
removetime = -1
supermovetime = -1
pausemovetime = -1
ignorehitpause = 1
scale = 2,2

[State 10000, Explod Zwang]
type = Explod
trigger1 = time = 0
anim = 19896
id = 19896
pos =  160,120
postype = left
sprpriority = -5
facing = 1
bindtime = -1
ownpal = 1
removetime = 9999999999999
pausemovetime = 99999999999999
supermovetime = 99999999999999
ignorehitpause = 1
scale = .9,1.2

[State 10000, Scale Explod]
type = ModifyExplod
trigger1 = time>50
scale = .9+.005*(time-50), 1.2+.005*(time-50)
id = 19896

[State 1003, Helper]
type = Helper
trigger1 = !time
helpertype = Normal
name = "yellow_BG"
id = 19897
pos = 0,0
postype = left
facing = 1
stateno = 19897
keyctrl = 0
ownpal = 1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
persistent = 0

[State 13300, white screen fade]
type = Explod
trigger1 = Time = 60
anim = 19883
ID = 2771
postype = left
pos = 0,-50
bindtime = -1
removetime = 91
pausemovetime = 91
ontop = 1
scale = 2,3
ignorehitpause = 1

[State 10000, RemoveExplod zwang]
type = RemoveExplod
trigger1 = time = 140
id = 19896
[State 10000, RemoveExplod yellow BG]
type = RemoveExplod
trigger1 = time = 140
id = 19897
[State 10000, RemoveExplod white BG]
type = RemoveExplod
trigger1 = time = 140
id = 11111

[State 10000, pause]
type = Pause
trigger1 = !time
time = 20
movetime = 20
ignorehitpause = 1

[State 8020, End]
type = destroyself
trigger1 = !(roundstate>2)
trigger2 = time=150

;--------------------------------------
;Yellow Super BG Helper
[Statedef 19897]
type = S
movetype = I
physics = N
anim = 19897
sprpriority = -6

[State 1004, assert]
type = bindtoparent
trigger1 = 1
pos = 0,120
ignorehitpause = 1

[State 1004, assert]
type = assertspecial
trigger1 = 1
flag = noshadow
flag2 = noFG
ignorehitpause = 1

[State 1004, assert]
type = angledraw
trigger1 = time < 50
value = 10*time
scale = .7,.7
ignorehitpause = 1

[State 1004, assert]
type = angledraw
trigger1 = time >= 50
value = 10*time
scale = .7+.01*(time-50),.7+.01*(time-50)
ignorehitpause = 1

[State 1004, DestroySelf]
type = DestroySelf
trigger1 = time > 130

;==========================================================
; SUPER BG - Jojo's Bizarre Adventure

[Statedef 19900]
type    = A
movetype= I
physics = N
ctrl = 0
anim = 15999
sprpriority = -21

[State 1211, Exclamation]
type = Explod
trigger1 = Time = 0
anim = 19910
id = 8001
pos = 0,-10
postype = back
sprpriority = -21
bindtime = -1
scale = 0.83333333333333333333333333333333,1.0810810810810810810810810810811
removetime = -1
supermovetime = -1
pausemovetime = -1
ignorehitpause = 1

[State 1211, Exclamation]
type = Explod
trigger1 = Time = 0
anim = 19911
id = 8001
pos = 0,-10
postype = back
sprpriority = -21
bindtime = -1
scale = 0.83333333333333333333333333333333,1.0810810810810810810810810810811
removetime = -1
supermovetime = -1
pausemovetime = -1
ignorehitpause = 1

[State 1211, Exclamation]
type = Explod
trigger1 = Time = 0
anim = 19912
id = 8001
pos = 0,-10
postype = back
sprpriority = -21
bindtime = -1
scale = 0.83333333333333333333333333333333,1.0810810810810810810810810810811
removetime = -1
supermovetime = -1
pausemovetime = -1
ignorehitpause = 1

[State 1211, Exclamation]
type = Explod
trigger1 = Time = 0
anim = 19913
id = 8001
pos = 0,-10
postype = back
sprpriority = -21
bindtime = -1
scale = 0.83333333333333333333333333333333,1.0810810810810810810810810810811
removetime = -1
supermovetime = -1
pausemovetime = -1
ignorehitpause = 1

[State 1211, Exclamation]
type = Explod
trigger1 = Time = 0
anim = 19900
id = 19900
pos = 0,0
postype = back
sprpriority = 5
bindtime = -1
scale = .84, 1.07
supermovetime = -1
pausemovetime = -1
ignorehitpause = 1
persistent = 0
ontop = 1

[State 10500, snd]
type = playsnd
trigger1 = !time
value = 9,0

[state haha]
type = varset
trigger1 = time = 0
var(3) = 0

[state haha]
type = varadd
trigger1 = time >= 5
trigger1 = var(3) < 220
var(3) = 5

[State that starts the inverted effect]
type           = PalFX
trigger1       = time >= 5
add            = var(3),var(3),var(3)
time           = 1
ignorehitpause = 1

[State 2030, 0]
type = AssertSpecial
Trigger1 = Time < ifelse(matchover, 120, 50)
flag = nofg
flag2 = nobardisplay
ignorehitpause = 1

[State haha]
type = RemoveExplod
trigger1 = Time = ifelse(matchover, 120, 50)
id = 8001

[State ChangeState!]
type = DestroySelf
trigger1 = RoundState = 0

;===================================================
;DASH COLLISION NOTIFICATION

[Statedef 13200]
type=A
physics=N
movetype=I
anim = 15999
velset=0,0
sprpriority=6

[State 8000, Assert]
type=assertspecial
trigger1= 1
flag=noshadow
ignorehitpause = 1

[State -2, Explod]; Notification
type = Explod
trigger1 = !time
anim = 13200
removetime = -2
supermove = 1
sprpriority = 1
id = 13200
bindtime = -1
ontop = 1
ownpal = 1
ignorehitpause = 1
pausemovetime = -1
facing = facing
scale = 0.5,0.5

[state 17100,scale FX]
type = modifyexplod
trigger1 = numexplod(13200)
trigger1 = time>=10
scale = 0.5+0.02*(time-10),0.5+0.02*(time-10)
id = 13200

[State 8000, End]
type=destroyself
trigger1= time>=40

;===================================================
;BEAM COLLISION NOTIFICATION

[Statedef 13250]
type=A
physics=N
movetype=I
anim = 15999
velset=0,0
sprpriority=6

[State 8000, Assert]
type=assertspecial
trigger1= 1
flag=noshadow
ignorehitpause = 1

[State -2, Explod]; Notification
type = Explod
trigger1 = !time
anim = 13250
removetime = -2
supermove = 1
sprpriority = 1
id = 13250
bindtime = -1
ontop = 1
ownpal = 1
ignorehitpause = 1
pausemovetime = -1
pos = 160,120
postype = left
scale = 0.5,0.5

[state 17100,scale FX]
type = modifyexplod
trigger1 = numexplod(13250)
trigger1 = time>=10
scale = 0.5+0.02*(time-10),0.5+0.02*(time-10)
id = 13250

[State 8000, End]
type=destroyself
trigger1= time>=40


;===================================================
[StateDef 2771] ; Fade in/out effects BLACK
type = A
movetype = I
physics = N
anim = 15999
velset = 0,0

[State 13300, Expl]
type = Explod
trigger1 = Time = 30
anim = 2771
ID = 2771
postype = left
pos = -30,-30
bindtime = -1
removetime = 71
pausemovetime = 71
ontop = 1
scale = 2,2

[State 13300, Fadeout]
type = PalFX
trigger1 = Time = [30,100]
time = 1
add = 4*(Time-30),4*(Time-30),4*(Time-30)

[State 13001, End]
type = DestroySelf
trigger1 = time=101

;===================================================
; Limit basics comboability
[Statedef 15999]
type    = S
movetype= A
physics = N
anim = 15999
sprpriority = -5

[State 2260, muteki]
type = NotHitBy
trigger1 = 1
value = SCA

[State 2260, destroy]
type = DestroySelf
trigger1 = numenemy
trigger1 = enemynear, movetype != H || (enemynear, stateno = [120,155]) || enemynear, ctrl
trigger2 = time = 24

;===================================================
;Pulse Effect during fall recovery (taken from Possessed Heita by The_None)

[Statedef 52100]
type    = S
movetype = I
physics = S
sprpriority = 4
anim = 15999
ctrl = 0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,AA,AP,AT

[State 0, PosAdd]
type = PosAdd
trigger1 = 1
x = ifelse(root,stateno=5201,ceil(parentdist x/3.0),parentdist x)
y = parentdist y

[State 0, VarSet]
type = VarSet
trigger1 = !time
var(0) = parent,anim

[State 0, VarSet]
type = VarSet
trigger1 = !time
var(1) = parent,animelemno(0)

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = time
value = var(0)
elem = var(1)

[State 0, VarSet]
type = VarAdd
trigger1 = time
fvar(0) = 11.2

[State 0, VarSet]
type = VarAdd
trigger1 = time
fvar(1) = 0.015

[State 0, AngleDraw]
type = AngleDraw
trigger1 = 1
scale = 1+fvar(1),1+fvar(1)

[State 0, Trans]
type = Trans
trigger1 = 1
trans = add

[State 0, PalFX]
type = PalFX
trigger1 = 1
time = 1
add = floor(0-fvar(0)),floor(0-fvar(0)),floor(0-fvar(0))

[State 0, ]
type = DestroySelf
trigger1 = root,stateno != 5201
trigger1 = root,stateno != 5210


;Super Limiter Timer
[Statedef 9999]
type    = S
movetype= I
physics = N
anim = 9999
sprpriority = 9

;ID:9999 Pong

[State 1061, NotHitBy]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = invisible

[State 1061, End]
type = destroyself
trigger1 = time>=360

;Combo Keeper
[Statedef 11111]
type    = S
movetype= I
physics = N
anim = 9999
sprpriority = 9

[State 0, VelSet]
type = VelSet
trigger1 = !time
x = 0
y = 0
ignorehitpause = 1

[State 1061, NotHitBy]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = invisible

[State 1061, End]
type = destroyself
trigger1 = enemy,movetype!=H ;|| time>=40
;==========================================================
; END BABIDI




;=====================================
; Run Dust FX
;=====================================

[Statedef 10000]
type = S
movetype = I
physics = N
anim = 10000
sprpriority = 5
velset = 0,0

[State 1061, Bind]
type = BindToRoot
trigger1 = 1
time = 1
pos = -40,4+ceil(-root,pos Y)

[State 1002, NoShadow]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[State 1061, End]
type = destroyself
trigger1 = animtime = 0

;====================================
; Broken Back - BG Arms + legs

[Statedef 245947]
type = S
movetype = H
physics = N
velset = 0,0
anim = 5947

[State 2260, bind]
type = bindtoroot
trigger1 = 1
pos = 0,0

[State 2260, muteki]
type = NotHitBy
trigger1 = 1
value = SCA

[State 2260, destroy]
type = DestroySelf
trigger1 = time = 126

;====================================
; RE Broken Back - BG Arms + legs

[Statedef 355947]
type = S
movetype = H
physics = N
velset = 0,0
anim = 5947

[State 2260, bind]
type = bindtoroot
trigger1 = 1
pos = 0,0

[State 2260, muteki]
type = NotHitBy
trigger1 = 1
value = SCA

[State 2260, destroy]
type = DestroySelf
trigger1 = time = 19


;======================================================================
;KILLED BY FINAL FLASH, BURNED, SMOKE HELPER
[Statedef 5945]
type = A
movetype = I
physics = N
anim = 15999
sprpriority = 3
velset = 0,0

[State 0, posset]
type = posset
trigger1 = ishelper(5945)
trigger1 = playeridexist(root,var(28))
x = playerid(root,var(28)),pos x
y = playerid(root,var(28)),pos y-20
ignorehitpause = 1
 
[State 0, posset]
type = posset
trigger1 = ishelper(59450)
trigger1 = playeridexist(root,var(29))
x = playerid(root,var(29)),pos x
y = playerid(root,var(29)),pos y-20
ignorehitpause = 1

[state 1315]
type = varset
triggerall = numenemy
trigger1 = !time
fvar(1) = abs(enemy,const(size.head.pos.y)/65.0)

[state 17100, big smoke]
type = explod
trigger1 = (time%20)=0
anim = 5930
id = 5930
pos = ceil(10*fvar(1)),-20
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2

[state 17100, big smoke]
type = explod
trigger1 = (time%20)=6
anim = 5930
id = 5930
pos = ceil(-30*fvar(1)),-10
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2

[state 17100, big smoke]
type = explod
trigger1 = (time%20)=3
anim = 5930
id = 5930
pos = ceil(47*fvar(1)),-5
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2

[state 17100, small smoke]
type = explod
trigger1 = (time%20)=8
anim = 5931
id = 5931
pos = ceil(-10*fvar(1)),-25
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2

[state 17100, small smoke]
type = explod
trigger1 = (time%20)=12
anim = 5931
id = 5931
pos = ceil(32*fvar(1)),-15
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2

[state 17100, small smoke]
type = explod
trigger1 = (time%20)=16
anim = 5931
id = 5931
pos = ceil(0*fvar(1)),-5
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2

[state 17100, small smoke]
type = explod
trigger1 = (time%20)=3
anim = 5931
id = 5931
pos = ceil(25*fvar(1)),-25
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2



;----------------------------------------------------
;[MAJIN]
;Babidi Charge Helper
[Statedef 9100]
type = A
movetype = I
physics = N
ctrl = 0
anim = IfElse((root,var(33)<700),9101,IfElse(((root,var(33))>=700 && (root,var(33))<1400),9102,9103))
velset = 0,0
sprpriority = -1

[State 9100, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

[State 9100, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = NoShadow

[State 9100, Fade In]
type = Trans
trigger1 = time = [0,32]
trans = addalpha
alpha = 0+8*time,256-8*time

[State 9100, Offset]
type = Offset
trigger1 = 1
x = 0
y = 5*sin(time/5.0)

[State 9100, VelSet]
type = null ;VelSet
trigger1 = rootdist X != [75,125]
x = IfElse(rootdist X>125,1.5,-1.5)

[State 9100, VelSet]
type = null ;VelSet
trigger1 = rootdist X = [75,125]
x = 0

[State 9100, ChangeAnim 1-2]
type = ChangeAnim
trigger1 = Anim=9101
trigger1 = root,var(33)>=700
value = 9102
ignorehitpause = 1
;persistent =

[State 9100, ChangeAnim 2-1]
type = ChangeAnim
trigger1 = Anim=9102
trigger1 = root,var(33)<700
value = 9101
ignorehitpause = 1
;persistent =

[State 9100, Babidi voice] ; kekekeke/Make them bleed
type = PlaySnd
triggerall = random<333
trigger1 = Anim=9101
trigger1 = AnimElemTime(1)=0
value = 9100,0+random%2
channel = 8
persistent = 0

[State 9100, Babidi voice] ; Wh...What??
type = PlaySnd
triggerall = random<333
trigger1 = Anim=9102 || Anim=9103
trigger1 = AnimElemTime(1)=0
value = 9100,10+random%2
channel = 8
persistent = 0


[State 9100, ChangeAnim 2-3]
type = ChangeAnim
trigger1 = Anim=9102
trigger1 = root,var(33)>=1400
value = 9103
ignorehitpause = 1
;persistent =

[State 9100, ChangeAnim 3-2]
type = ChangeAnim
trigger1 = Anim=9103
trigger1 = root,var(33)<1400
value = 9102
ignorehitpause = 1
;persistent =

[State 9100, Go to Vanish]
type = ChangeState
trigger1 = Root,StateNo != 910
value = 9105
ctrl = 0


;----------------------------------------------------
;[MAJIN]
;Babidi Charge Helper Vanish
[Statedef 9105]
type = A
movetype = I
physics = N
ctrl = 0
;anim = IfElse((root,var(33)<700),9100,IfElse(((root,var(33))>=700 && (root,var(33))<1400),9101,9102))
velset = 0,0
sprpriority = -1

[State 9105, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

[State 9105, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = NoShadow

[State 9105, Offset]
type = Offset
trigger1 = 1
x = 0
y = 5*sin(time/5.0)

[State 9105, VelSet]
type = null ;VelSet
trigger1 = rootdist X != [75,125]
x = IfElse(rootdist X>125,1.5,-1.5)

[State 9105, VelSet]
type = null ;VelSet
trigger1 = rootdist X = [75,125]
x = 0

[State 9105, Fade Away]
type = Trans
trigger1 = time>0
trans = addalpha
alpha = 256-8*(time),0+8*(time)

[State 9105, Back to Sanity Charge]
type = ChangeState
trigger1 = Root,StateNo = 910
value = 9100
ctrl = 0

[State 9105, DestroySelf]
type = DestroySelf
trigger1 = time = 32

;[MAJIN]
;----------------------------------------------------
;Babidi Idle
[Statedef 9110]
type = A
movetype = I
physics = N
ctrl = 0
anim = 9100
velset = 0,0
sprpriority = 8 ;-10

[State 3010, Babidi power]
type = Explod
trigger1 = !Time
trigger1 = root,stateno!=789 ;Turning around
anim =  9115
ID =  9115
pos = 0,0
postype = p1 ;p2,front,back,left,right
supermovetime = 9999
pausemovetime = 9999
facing = 1
vfacing = 1
bindtime = -1
removetime = -1
scale = 1,1
sprpriority = 9 ;-9
ownpal = 1
removeongethit = 0
ignorehitpause = 1

[State 0, PlaySnd]
type = PlaySnd
trigger1 = root,stateno!=789 ;Turning around
trigger1 = !time
value = 2400,10
volume = 0
channel = -1

[State 3010, Babidi talk]
type = Explod
trigger1 = !Time
anim =  9110
ID =  9110
pos = 0,0
postype = p1 ;p2,front,back,left,right
supermovetime = 9999
pausemovetime = 9999
facing = 1
vfacing = 1
bindtime = -1
removetime = -1
scale = 1,1
sprpriority = 10 ;-8
ownpal = 1
removeongethit = 0
ignorehitpause = 1

[State 13100, Babidi Voice] ;TEMP
type = null ;playsnd
trigger1 = !Time
value = 188,8
volume = 300
channel = -1
persistent = 0

[State 0, Remove Power]
type = RemoveExplod
trigger1 = Root,StateNo=0
trigger2 = root,stateno=3901 && time=110 ;Necromancer
id = 9115

[State 0, Remove Talk]
type = RemoveExplod
trigger1 = Root,StateNo=0
trigger2 = root,stateno=3901 && time=420 ;110 ;Necromancer
trigger3 = root,stateno=789 && time=380 ;420  ;Turning around
trigger4 = root,stateno=735 && time=210 ;250  ;Leeching energy
id = 9110


[State 9105, DestroySelf]
type = DestroySelf
trigger1 = Root,StateNo=0



